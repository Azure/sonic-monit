.\" Automatically generated by Pod::Man 2.25 (Pod::Simple 3.16)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "MONIT 1"
.TH MONIT 1 "www.mmonit.com" "May 12. 2014" "User Commands"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Monit \- utility for monitoring services on a Unix system
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBmonit\fR [options] {arguments}
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBmonit\fR is a utility for managing and monitoring processes,
programs, files, directories and filesystems on a Unix system.
Monit conducts automatic maintenance and repair and can execute
meaningful causal actions in error situations. E.g. Monit can
start a process if it does not run, restart a process if it does
not respond and stop a process if it uses too much resources. You
can use Monit to monitor files, directories and filesystems for
changes, such as timestamps changes, checksum changes or size
changes.
.PP
Monit is controlled via an easy to configure control file based
on a free-format, token-oriented syntax. Monit logs to syslog or
to its own log file and notifies you about error conditions via
customizable alert messages. Monit can perform various \s-1TCP/IP\s0
network checks, protocol checks and can utilize \s-1SSL\s0 for such
checks. Monit provides a http(s) interface and you may use a
browser to access the Monit program.
.SH "WHAT TO MONITOR?"
.IX Header "WHAT TO MONITOR?"
You can use Monit to monitor daemon \fBprocesses\fR or similar
programs running on localhost. Monit is particularly useful for
monitoring daemon processes, such as those started at system boot
time from /etc/init.d/. For instance sendmail, sshd, apache and
mysql. In contrast to many other monitoring systems, Monit can act if
an error situation should occur, e.g.; if sendmail is not
running, monit can start sendmail again automatically or if
apache is using too many resources (e.g. if a DoS attack is in
progress) Monit can stop or restart apache and send you an alert
message. Monit can also monitor process characteristics, such as
how much memory or cpu cycles a process is using.
.PP
You can also use Monit to monitor \fBfiles\fR, \fBdirectories\fR and
\&\fBfilesystems\fR on localhost. Monit can monitor these items for
changes, such as timestamps changes, checksum changes or size
changes. This is also useful for security reasons \- you can
monitor the md5 or sha1 checksum of files that should not change
and get an alert or perform an action if they should change.
.PP
Monit can monitor \fBnetwork connections\fR to various servers,
either on localhost or on remote hosts. \s-1TCP\s0, \s-1UDP\s0 and Unix Domain
Sockets are supported. Network test can be performed on a
protocol level; Monit has built-in tests for the main Internet
protocols, such as \s-1HTTP\s0, \s-1SMTP\s0 etc. Even if a protocol is not
supported you can still test the server because you can configure
Monit to send any data and test the response from the server.
.PP
Monit can be used to test \fBprograms\fR or scripts at certain
times, much like cron, but in addition, you can test the exit
value of a program and perform an action or send an alert if the
exit value indicate an error. This means that you can use Monit
to perform any type of check you can write a script for.
.PP
Finally, Monit can be used to monitor general \fBsystem\fR resources
on localhost such as overall \s-1CPU\s0 usage, Memory and Load Average.
.SH "GENERAL OPERATION"
.IX Header "GENERAL OPERATION"
The behavior of Monit is controlled by command-line options
\&\fIand\fR a run control file, monitrc,
the syntax of which we describe in a later section. Command-line
options override \fI.monitrc\fR declarations.
.PP
The default location for \fImonitrc\fR is \fI~/.monitrc\fR. If this
file does not exist, Monit will try \fI/etc/monitrc\fR and a few
other places. See \s-1FILES\s0 for details. You can also
specify the control file directly by using the \fI\-c\fR command-line
switch to monit. For instance,
.PP
.Vb 1
\& $ monit \-c /var/monit/monitrc
.Ve
.PP
Before Monit is started the first time, you can test the control
file for syntax errors:
.PP
.Vb 2
\& $ monit \-t 
\& $ Control file syntax OK
.Ve
.PP
If there was an error, Monit will print an error message to the
console, including the line number in the control file from where
the error was found.
.PP
Once you have a working Monit control file you can start Monit
from the console, like so:
.PP
.Vb 1
\& $ monit
.Ve
.PP
You can change some configuration directives via command-line
switches, but for simplicity it is recommended that you put these
in the control file.
.PP
If all goes well, Monit will now detach from the terminal and run
as a background process, i.e. as a daemon process. As a daemon,
Monit runs in cycles; It monitor services, then goes to sleep for
a configured period, then wakes up and start monitoring again in
an endless loop.
.SS "Options"
.IX Subsection "Options"
The following options are recognized by Monit. However, it is
recommended that you set options (when applicable) directly in
the \fI.monitrc\fR control file.
.PP
\&\fB\-c\fR \fIfile\fR
   Use this control file
.PP
\&\fB\-d\fR \fIn\fR
   Run Monit as a daemon once per \fIn\fR seconds. Or use \fI\*(L"set
   daemon\*(R"\fR in monitrc.
.PP
\&\fB\-g\fR \fIname\fR
   Set group name for start, stop, restart, monitor and
   unmonitor action.
.PP
\&\fB\-l\fR \fIlogfile\fR
   Print log information to this file. Or use \fI\*(L"set logfile\*(R"\fR
    in monitrc.
.PP
\&\fB\-p\fR \fIpidfile\fR
   Use this lock file in daemon mode. Or use \fI\*(L"set pidfile\*(R"\fR
    in monitrc.
.PP
\&\fB\-s\fR \fIstatefile\fR
   Write state information to this file. Or use \fI\*(L"set
   statefile\*(R"\fR in monitrc.
.PP
\&\fB\-I\fR
   Do not run in background (needed for run from init)
.PP
\&\fB\-i\fR
   Print Monit's unique \s-1ID\s0
.PP
\&\fB\-r\fR
   Reset Monit's unique \s-1ID\s0. Use with caution
.PP
\&\fB\-t\fR
   Run syntax check for the control file
.PP
\&\fB\-v\fR
   Verbose mode, work noisy (diagnostic output)
.PP
\&\fB\-vv\fR
   Very verbose mode, same as \-v plus log stack-trace on error
.PP
\&\fB\-H\fR \fI[filename]\fR
   Print \s-1MD5\s0 and \s-1SHA1\s0 hashes of the file or of stdin if the 
   filename is omitted; Monit will exit afterwards
.PP
\&\fB\-V\fR
   Print version number and patch level
.PP
\&\fB\-h\fR
   Print a help text
.SS "Arguments"
.IX Subsection "Arguments"
Once you have Monit running as a daemon process, you can call
Monit with one of the following arguments. Monit will then
connect to the Monit daemon (on \s-1TCP\s0 port 127.0.0.1:2812 by
default) and ask the Monit daemon to perform the requested
action. In other words; calling monit without arguments starts
the Monit daemon, and calling monit \fIwith\fR arguments enables you
to communicate with the Monit daemon process.
.IP "start all" 4
.IX Item "start all"
Start all services listed in the control file and enable
monitoring for them. If the group option is set (\fI\-g\fR), only
start and enable monitoring of services in the named group (\*(L"all\*(R"
is not required in this case).
.IP "start name" 4
.IX Item "start name"
Start the named service and enable monitoring for it. The name is
a service entry name from the monitrc file.
.IP "stop all" 4
.IX Item "stop all"
Stop all services listed in the control file and disable their
monitoring. If the group option is set, only stop and disable
monitoring of the services in the named group (all" is not
required in this case).
.IP "stop name" 4
.IX Item "stop name"
Stop the named service and disable its monitoring. The name is a
service entry name from the monitrc file.
.IP "restart all" 4
.IX Item "restart all"
Stop and start \fIall\fR services. If the group option is set, only
restart the services in the named group (\*(L"all\*(R" is not required in
this case).
.IP "restart name" 4
.IX Item "restart name"
Restart the named service. The name is a service entry name from
the monitrc file.
.IP "monitor all" 4
.IX Item "monitor all"
Enable monitoring of all services listed in the control file. If
the group option is set, only start monitoring of services in the
named group (\*(L"all\*(R" is not required in this case).
.IP "monitor name" 4
.IX Item "monitor name"
Enable monitoring of the named service. The name is a service
entry name from the monitrc file. Monit will also enable
monitoring of all services this service depends on.
.IP "unmonitor all" 4
.IX Item "unmonitor all"
Disable monitoring of all services listed in the control file. If
the group option is set, only disable monitoring of services in
the named group (\*(L"all\*(R" is not required in this case).
.IP "unmonitor name" 4
.IX Item "unmonitor name"
Disable monitoring of the named service. The name is a service
entry name from the monitrc file. Monit will also disable
monitoring of all services that depends on this service.
.IP "status" 4
.IX Item "status"
Print status information of each service.
.IP "summary" 4
.IX Item "summary"
Print a short status summary.
.IP "reload" 4
.IX Item "reload"
Reinitialize a running Monit daemon, the daemon will reread its
configuration, close and reopen log files.
.IP "quit" 4
.IX Item "quit"
Kill the Monit daemon process
.IP "validate" 4
.IX Item "validate"
Check all services listed in the control file. This action is
also the default behavior when Monit runs in daemon mode.
.IP "procmatch regex" 4
.IX Item "procmatch regex"
Allows for easy testing of pattern for process match check. The
command takes regular expression as an argument and displays all
running processes matching the pattern.
.SH "THE MONIT CONTROL FILE"
.IX Header "THE MONIT CONTROL FILE"
Monit is configured and controlled via a control file called
\&\fImonitrc\fR. The default location for this file is ~/.monitrc. If
this file does not exist, Monit will try /etc/monitrc, then
\&\f(CW@sysconfdir\fR@/monitrc and finally ./monitrc. The value of
\&\f(CW@sysconfdir\fR@ is given at configure time as ./configure
\&\-\-sysconfdir. For instance, using  \fI./configure \-\-sysconfdir
/var/monit/etc\fR will make Monit search for \fImonitrc\fR in
\&\fI/var/monit/etc\fR
.PP
To protect the security of your control file and passwords the
control file must have permissions \fIno more than 0700\fR
(u=xrw,g=,o=); Monit will complain and exit otherwise.
.PP
When there is a conflict between the command-line arguments and
the arguments in this file, the command-line arguments take
precedence.
.PP
Monit uses its own Domain Specific Language (\s-1DSL\s0); The control
file consists of a series of service entries and global option
statements in a free-format, token-oriented syntax.
.PP
Comments begin with a '#' and extend through the end of the line.
.PP
Otherwise the file consists of a series of service entries or
global option statements in a free-format, token-oriented syntax.
.PP
You can use noise keywords like 'if', 'and', 'with(in)', 'has',
\&'us(ing|e)', 'on(ly)', 'then', 'for', 'of'  anywhere in an
entry to make it resemble English. They're ignored, but can make
entries much easier to read at a glance.  Keywords are case
insensitive.
.PP
There are three kinds of tokens: \fIgrammar\fR, \fInumbers\fR (i.e.
decimal digit sequences) and \fIstrings\fR. Strings can be either
quoted or unquoted. A quoted string is bounded by double quotes
and may contain whitespace (and quoted digits are treated as a
string). An unquoted string is any whitespace-delimited token,
containing characters and/or numbers.
.PP
On a semantic level, the control file consists of three types of
entries:
.IP "1. Global set-statements" 4
.IX Item "1. Global set-statements"
A global set-statement starts with the keyword \fIset\fR and the
item to configure.
.IP "2. Global include-statement" 4
.IX Item "2. Global include-statement"
The include statement consists of the keyword \fIinclude\fR and
a glob string.
.IP "2. One or more service entry statements." 4
.IX Item "2. One or more service entry statements."
Each service entry consists of the keywords \fIcheck\fR, followed by
the service type. Each entry requires a \fBunique\fR descriptive
name, which may be freely chosen. This name is used by monit
to refer to the service internally and in all interactions
with the user.
.PP
Currently, eight types of check statements are supported:
.IP "1. \s-1CHECK\s0 \s-1PROCESS\s0 <unique name> <\s-1PIDFILE\s0 <path> | \s-1MATCHING\s0 <regex>>" 4
.IX Item "1. CHECK PROCESS <unique name> <PIDFILE <path> | MATCHING <regex>>"
<path> is the absolute path to the program's pidfile. If the
pidfile does not exist or does not contain the pid number of a
running process, Monit will call the entry's start method if
defined.
<regex> is alternative process specification using pattern matching
to process name (command line) from process table instead of pidfile.
The first match is used so this form of check is useful for unique
pattern matching \- the pidfile should be used where possible as it
defines expected pid exactly (pattern matching won't be useful for
Apache in most cases for example).
The pattern can be obtained using \fImonit procmatch \*(L".*\*(R"\fR \s-1CLI\s0 command
which lists all processes visible to Monit or using the \fIps\fR utility.
The \*(L"procmatch\*(R" \s-1CLI\s0 command can be used to test your pattern as well.
If Monit runs in passive mode or the start methods is not defined,
Monit will just send alerts on errors.
.IP "2. \s-1CHECK\s0 \s-1FILE\s0 <unique name> \s-1PATH\s0 <path>" 4
.IX Item "2. CHECK FILE <unique name> PATH <path>"
<path> is the absolute path to the file. If the file does not
exist or disappeared, Monit will call the entry's start method if
defined, if <path> does not point to a regular file type (for
instance a directory), Monit will disable monitoring of this
entry. If Monit runs in passive mode or the start methods is not
defined, Monit will just send alerts on errors.
.IP "3. \s-1CHECK\s0 \s-1FIFO\s0 <unique name> \s-1PATH\s0 <path>" 4
.IX Item "3. CHECK FIFO <unique name> PATH <path>"
<path> is the absolute path to the fifo. If the fifo does not
exist or disappeared, Monit will call the entry's start method if
defined, if <path> does not point to a fifo type (for
instance a directory), Monit will disable monitoring of this
entry. If Monit runs in passive mode or the start methods is not
defined, Monit will just send alerts on errors.
.IP "4. \s-1CHECK\s0 \s-1FILESYSTEM\s0 <unique name> \s-1PATH\s0 <path>" 4
.IX Item "4. CHECK FILESYSTEM <unique name> PATH <path>"
<path> is the path to the filesystem block special device, mount point,
file or a directory which is part of a filesystem. It is
recommended to use a block special file directly (for example
/dev/hda1 on Linux or /dev/dsk/c0t0d0s1 on Solaris, etc.) If you
use a mount point (for example /data), be careful, because if the
filesystem is unmounted the test will still be true because the mount
point exist.
.Sp
If the filesystem becomes unavailable, Monit will call the entry's
start method if defined. if <path> does not point to a filesystem,
Monit will disable monitoring of this entry. If Monit runs in
passive mode or the start methods is not defined, Monit will just
send alerts on errors.
.IP "5. \s-1CHECK\s0 \s-1DIRECTORY\s0 <unique name> \s-1PATH\s0 <path>" 4
.IX Item "5. CHECK DIRECTORY <unique name> PATH <path>"
<path> is the absolute path to the directory. If the directory
does not exist or disappeared, Monit will call the entry's start
method if defined, if <path> does not point to a directory, monit
will disable monitoring of this entry. If Monit runs in passive
mode or the start methods is not defined, Monit will just send
alerts on errors.
.IP "6. \s-1CHECK\s0 \s-1HOST\s0 <unique name> \s-1ADDRESS\s0 <host address>" 4
.IX Item "6. CHECK HOST <unique name> ADDRESS <host address>"
The host address can be specified as a hostname string or as an
ip-address string on a dotted decimal format. Such as,
tildeslash.com or \*(L"64.87.72.95\*(R".
.IP "7. \s-1CHECK\s0 \s-1SYSTEM\s0 <unique name>" 4
.IX Item "7. CHECK SYSTEM <unique name>"
The system name is usually hostname, but any descriptive name can be
used. You can use the variable \f(CW$HOST\fR as the name, which will expand to
the hostname. This test allows one to check general system resources
such as \s-1CPU\s0 usage (percent of time spent in user, system and wait),
total memory usage or load average. The unique name is used as the
system hostname in mail alerts and when M/Monit is configured, then
also as initial name of the host entry in M/Monit.
.IP "8. \s-1CHECK\s0 \s-1PROGRAM\s0 <unique name> \s-1PATH\s0 <executable file> [\s-1TIMEOUT\s0 <number> \s-1SECONDS\s0]" 4
.IX Item "8. CHECK PROGRAM <unique name> PATH <executable file> [TIMEOUT <number> SECONDS]"
<path> is the absolute path to the executable program or script.
The \fIstatus\fR test allows one to check the program's exit status. If
program will not finish within <number> seconds, Monit will terminate
it. The default program timeout is 600 seconds (5 minutes).
.SH "LOGGING"
.IX Header "LOGGING"
Monit will log status and error messages to a log file. Use the
\&\fIset logfile\fR statement in the monitrc control file. To setup
Monit to log to its own logfile, use e.g. \fIset logfile
/var/log/monit.log\fR. If \fBsyslog\fR is given as a value for the
\&\fI\-l\fR command-line switch (or the keyword \fIset logfile syslog\fR
is found in the control file) Monit will use the \fBsyslog\fR system
daemon to log messages with a priority assigned to each message
based on the context. To turn off logging, simply do not set the
logfile in the control file (and of course, do not use the \-l
switch)
.SH "DAEMON MODE"
.IX Header "DAEMON MODE"
Use
.PP
.Vb 1
\& set daemon n (where n is a number in seconds)
.Ve
.PP
to specify Monit's poll cycle length and run Monit in daemon
mode. You must specify a numeric argument which is a polling
interval in seconds. In daemon mode, Monit detaches from the
console, puts itself in the background and runs continuously,
monitoring each specified service and then goes to sleep for the
given poll interval, wakes up and start monitoring again in an
endless cycle.
.PP
Alternatively, you can use the \fI\-d\fR command line switch to set
the poll interval, but it is strongly recommended to set the poll
interval in your \fI~/.monitrc\fR file, by using \fIset daemon\fR.
.PP
Monit will then always start in daemon mode. If you do not use
this statement and do not start monit with the \-d option, Monit
will just run through the service checks once and then exit. This
may be useful in some situations, but Monit is primarily designed
to run as a daemon process.
.PP
Calling monit with a Monit daemon running in the background sends
a wake-up signal to the daemon, forcing it to check services
immediately. Calling monit with the quit argument will kill a
running Monit daemon process instead of waking it up.
.SH "INIT SUPPORT"
.IX Header "INIT SUPPORT"
The \fIset init\fR statement prevents Monit from transforming itself
into a daemon process. Instead Monit will run as a foreground
process. (You should still use set daemon to specify the poll
cycle).
.PP
This is required to run Monit from init. Using init to start
Monit is probably the best way to run Monit if you want to be
certain that you always have a running Monit daemon on your
system. Another option is to run Monit from crontab. In any case,
you should make sure that the control file does not have any
syntax errors before you start Monit from init or crontab.
.PP
To setup Monit to run from init, you can either use the set init
statement in Monit's control file or use the \-I option from the
command line. Here is what you must add to /etc/inittab:
.PP
.Vb 2
\&  # Run Monit in standard run\-levels
\&  mo:2345:respawn:/usr/local/bin/monit \-Ic /etc/monitrc
.Ve
.PP
After you have modified init's configuration file, you can run
the following command to re-examine /etc/inittab and start Monit:
.PP
.Vb 1
\&  telinit q
.Ve
.PP
For systems without telinit:
.PP
.Vb 1
\&  kill \-1 1
.Ve
.PP
If Monit is used to monitor services that are also started at
boot time (e.g. services started via \s-1SYSV\s0 init rc scripts or via
inittab) then, in some cases, a race condition could occur. That
is; if a service is slow to start, Monit can assume that the
service is not running and possibly try to start it and raise an
alert, while, in fact the service is already about to start or
already in its startup sequence. Please see the \s-1FAQ\s0 for a
solution to this problem.
.SH "INCLUDE FILES"
.IX Header "INCLUDE FILES"
The Monit control file, \fImonitrc\fR, can include additional
configuration files. This feature helps one to maintain a certain
structure or to place repeating settings into one file. Include
statements can be placed at virtually any spot. The syntax is the
following:
.PP
.Vb 1
\&  include globstring
.Ve
.PP
The globstring is any kind of string as defined in \fIglob\fR\|(7). Thus,
you can refer to a single file or you can load several files at
once. If you want to use whitespace in your string the globstring
need to be embedded into quotes (') or double quotes ("). If the
globstring matches a directory instead of a file, it is silently
ignored.
.PP
Any \fIinclude\fR statements in included files are parsed as in the
main control file.
.PP
If the globstring matches several results, the files are included
in a non sorted manner. If you need to rely on a certain order,
you might need to use single \fIinclude\fR statements.
.PP
An example,
.PP
.Vb 1
\& include /etc/monit.d/*.cfg
.Ve
.PP
This will load any file matching the globstring. That is, all
files in \fI/etc/monit.d\fR that ends with the prefix \fI.cfg\fR.
.SH "MONIT HTTPD"
.IX Header "MONIT HTTPD"
If specified in the control file, Monit will start a Monit daemon
with http support. From a Browser you can then start and stop
services, disable or enable service monitoring as well as view
the status of each service. Also, if Monit logs to its own file,
you can view the content of this logfile in a Browser.
.PP
The status page displayed by the Monit web server is automatically
refreshed with the same poll time set for the monit daemon.
.PP
The Monit web interface is required for \s-1CLI\s0 interface operation, as
all \s-1CLI\s0 commands (such as \*(L"monit status\*(R") are handled by the web
interface.
.PP
Syntax:
.IP "\s-1SET\s0 \s-1HTTPD\s0 \s-1PORT\s0 <number> \s-1ALLOW\s0 <user:password | IP-address | IP\-range>+ [\s-1ADDRESS\s0 <hostname | IP\-address>] [\s-1SSL\s0 <\s-1ENABLE\s0 | \s-1DISABLE\s0>] [\s-1PEMFILE\s0 <path>] [\s-1CLIENTPEMFILE\s0 <path>] [\s-1ALLOWSELFCERTIFICATION\s0] [\s-1SIGNATURE\s0 <\s-1ENABLE\s0 | \s-1DISABLE\s0>]" 4
.IX Item "SET HTTPD PORT <number> ALLOW <user:password | IP-address | IP-range>+ [ADDRESS <hostname | IP-address>] [SSL <ENABLE | DISABLE>] [PEMFILE <path>] [CLIENTPEMFILE <path>] [ALLOWSELFCERTIFICATION] [SIGNATURE <ENABLE | DISABLE>]"
.PP
Example:
.PP
.Vb 2
\& set httpd port 2812
\&     allow myuser:mypassword
.Ve
.PP
And you can use \fIhttp://localhost:2812/\fR to access the Monit web
interface from a browser.
.PP
\&\fI\s-1PORT\s0\fR option sets the port where Monit should listen. Monit uses
usually port 2812.
.PP
\&\fI\s-1ADDRESS\s0\fR option allows to make Monit listen on specific interface
only. For example if you \fBdon't\fR want to expose Monit web interface
on external network, bind it to localhost only. Monit will accept
connections on any address by default (if \s-1ADDRESS\s0 option is missing).
.PP
For example to limit the web interface to localhost only:
.PP
.Vb 4
\& set httpd
\&     port 2812
\&     use address 127.0.0.1
\&     allow myuser:mypassword
.Ve
.PP
\&\fI\s-1SSL\s0\fR, \fI\s-1PEMFILE\s0\fR allows to enable \s-1SSL\s0 for Monit web interface. The
pemfile holds both the server's private key and certificate. This file
should be stored in a safe place on the filesystem and should have
strict permissions, no more than 0700. Please see \s-1README\s0.SSL file
accompanying the software to get more information about certificates
and generating pem files.
.PP
For example:
.PP
.Vb 5
\& set httpd
\&     port 2812
\&     ssl enable
\&     pemfile /etc/certs/monit.pem
\&     allow myuser:mypassword
.Ve
.PP
You can use \fIhttps://localhost:2812/\fR to access the Monit web
server over a \s-1SSL\s0 encrypted connection.
.PP
OpenSSL \s-1FIPS\s0 is supported, to enable \s-1FIPS\s0 mode (provided your OpenSSL
library supports it), add this statement to Monit control file:
.PP
.Vb 1
\& SET FIPS
.Ve
.PP
\&\fI\s-1CLIENTPEMFILE\s0\fR, \fI\s-1ALLOWSELFCERTIFICATION\s0\fR options allow to set
client certificate based authentication. A connecting client has
to provide a certificate known to Monit in order to connect. This
file also needs to have all necessary \s-1CA\s0 certificates. By default
self-signed client certificates are \fBnot\fR allowed. If you want to
use a self signed certificate from a client it has to be allowed
explicitly with the \fI\s-1ALLOWSELFCERTIFICATION\s0\fR statement.
.PP
For example:
.PP
.Vb 5
\& set httpd
\&     port 2812
\&     ssl enable
\&     pemfile /etc/certs/monit.pem
\&     clientpemfile /etc/certs/monit\-client.pem
.Ve
.PP
\&\fI\s-1SIGNATURE\s0\fR option can be used to hide Monit version from the
\&\s-1HTTP\s0 response header and error pages.  For example:
.PP
.Vb 4
\&  set httpd
\&    port 2812
\&    signature disable
\&    allow myuser:mypassword
.Ve
.SS "Authentication"
.IX Subsection "Authentication"
Monit web interface access is controlled primarily controlled via the
\&\fB\s-1ALLOW\s0\fR option.
.PP
If the Monit command line interface is being used, at least one
cleartext password is necessary (see bellow), otherwise the Monit
command line interface will not be able to connect to the Monit
web interface.
.PP
Clients trying to connect to the server but supply the wrong
username and/or password are logged with their ip-address.
.PP
\fIClient certificates\fR
.IX Subsection "Client certificates"
.PP
See the \fI\s-1CLIENTPEMFILE\s0\fR option above.
.PP
\fIHost and network allow list\fR
.IX Subsection "Host and network allow list"
.PP
The http server maintains an access-control list of hosts and
networks allowed to connect to the server. You can add as many
hosts as you want to, but only hosts with a valid domain name or
its \s-1IP\s0 address are allowed. Networks require a network \s-1IP\s0 and a
netmask to be accepted.
.PP
The http server will query a name server to check any hosts
connecting to the server. If a host (client) is trying to connect
to the server, but cannot be found in the access list or cannot
be resolved, the server will shutdown the connection to the
client promptly.
.PP
Control file example:
.PP
.Vb 6
\&  set httpd port 2812
\&      allow localhost
\&      allow my.other.work.machine.com
\&      allow 10.1.1.1
\&      allow 192.168.1.0/255.255.255.0
\&      allow 10.0.0.0/8
.Ve
.PP
Clients, not mentioned in the allow list, trying to connect to
the server are logged with their ip-address.
.PP
\fIBasic Authentication\fR
.IX Subsection "Basic Authentication"
.PP
Monit supports Basic Authentication schema described in \s-1RFC\s0 2617.
.PP
In short; a server challenge a client (e.g. a Browser) to send
authentication information (username and password) and if
accepted, the server will allow the client access to the
requested document.
.PP
The biggest weakness with Basic Authentication is that the
username and password is sent in clear-text (i.e. base64 encoded)
over the network. It is therefor recommended that you do not use
this authentication method unless you run the Monit http server
with \fIssl\fR support. With ssl support it is completely safe to
use Basic Authentication since \fBall\fR http data, including Basic
Authentication headers will be encrypted.
.PP
Cleartext user and password
.IX Subsection "Cleartext user and password"
.PP
Monit will use Basic Authentication if an allow statement
contains a username and a password separated with a single ':'
character.  Special characters can be used but the password has
to be quoted.
.PP
Syntax:
.PP
.Vb 1
\& ALLOW <username>:<password>
.Ve
.PP
\s-1PAM\s0
.IX Subsection "PAM"
.PP
\&\s-1PAM\s0 is supported on platforms which provide \s-1PAM\s0 (such as Linux,
Mac \s-1OS\s0 X, FreeBSD, NetBSD).
.PP
Syntax:
.PP
.Vb 1
\& ALLOW @<group>
.Ve
.PP
where \fIgroup\fR is the group name allowed to access Monit web
interface. Monit uses \s-1PAM\s0 service called \fImonit\fR for \s-1PAM\s0
authentication, see \s-1PAM\s0 manual page for detailed instructions
how to set the \s-1PAM\s0 service and \s-1PAM\s0 authentication plugins.
.PP
Sample \s-1PAM\s0 service for Monit on Mac \s-1OS\s0 X (store as
\&\*(L"/etc/pam.d/monit\*(R" file):
.PP
.Vb 5
\&  # monit: auth account password session
\&  auth       sufficient     pam_securityserver.so
\&  auth       sufficient     pam_unix.so
\&  auth       required       pam_deny.so
\&  account    required       pam_permit.so
.Ve
.PP
And monitrc setting which allows only group admin authenticated
via \s-1PAM\s0 to access the web interface:
.PP
.Vb 3
\&  set httpd
\&      port 2812
\&      allow @admin
.Ve
.PP
htpasswd file
.IX Subsection "htpasswd file"
.PP
Alternatively you can use files in \*(L"htpasswd\*(R" format (one
user:passwd entry per line), like so: \fIallow
[cleartext|crypt|md5] /path [users]\fR. By default cleartext
passwords are read. In case the passwords are digested it is
necessary to specify the cryptographic method. If you do not want
all users in the password file to have access to Monit you can
specify only those users that should have access, in the allow
statement. Otherwise all users are added.
.PP
Example1:
.PP
.Vb 3
\&  set httpd port 2812
\&      allow hauk:password
\&      allow md5 /etc/httpd/htpasswd john paul ringo george
.Ve
.PP
If you use this method together with a host list, then only
clients from the listed hosts will be allowed to connect to the
Monit http server and each client will be asked to provide a
username and a password.
.PP
Example2:
.PP
.Vb 4
\&  set httpd port 2812
\&      allow localhost
\&      allow 10.1.1.1
\&      allow hauk:"password"
.Ve
.PP
If you only want to use Basic Authentication, then just provide
allow entries with username and password or password files as in
example 1 above.
.PP
Read-only users
.IX Subsection "Read-only users"
.PP
Finally it is possible to define some users as read-only. A
read-only user can read the Monit web pages but will \fInot\fR get
access to push-buttons and cannot change a service from the web
interface.
.PP
.Vb 5
\&  set httpd port 2812
\&      allow admin:password
\&      allow hauk:password read\-only
\&      allow @admins
\&      allow @users read\-only
.Ve
.PP
A user is set to read-only by using the \fIread-only\fR keyword
\&\fBafter\fR username:password. In the above example the user \fIhauk\fR
is defined as a read-only user, while the \fIadmin\fR user has all
access rights.
.SH "ALERT MESSAGES"
.IX Header "ALERT MESSAGES"
Monit will raise an event in the following situations:
.PP
.Vb 10
\& o A service does not exist (e.g. process is not running)
\& o Cannot read service data (e.g. cannot get filesystem usage)
\& o Execution of service related scripts failed (e.g. start failed)
\& o Invalid service type (e.g. if path points to directory instead of file)
\& o Custom test script returned error
\& o Ping test failed
\& o TCP/UDP connection and/or port test failed
\& o Resource usage test failed (e.g. cpu usage too high)
\& o Checksum mismatch or change (e.g. file changed)
\& o File size test failed (e.g. file too large)
\& o Timestamp test failed (e.g. file is older then expected)
\& o Permission test failed (e.g. file mode doesn\*(Aqt match)
\& o An UID test failed (e.g. file owned by different user)
\& o A GID test failed (e.g. file owned by different group)
\& o A process\*(Aq PID changed out of Monit control
\& o A process\*(Aq PPID changed out of Monit control
\& o Too many service recovery attempts failed
\& o A file content matched the pattern
\& o Filesystem flags changed
\& o A service action was performed by administrator
\& o Monit was started, stopped or reloaded
.Ve
.PP
To get an alert via e\-mail, set the alert target using \fIset alert\fR
statement.
.SS "Setting an alert recipient"
.IX Subsection "Setting an alert recipient"
If an event occurred, Monit will send an alert to all recipients. Syntax:
.IP "\s-1SET\s0 \s-1ALERT\s0 mail-address [[\s-1NOT\s0] {event, ...}] [\s-1REMINDER\s0 cycles]" 4
.IX Item "SET ALERT mail-address [[NOT] {event, ...}] [REMINDER cycles]"
.PP
Example:
.PP
.Vb 1
\& set alert foo@bar
.Ve
.PP
will send a default email to the address foo@bar whenever any event occurred on
any service.
.PP
If you want to send alert messages to more email addresses, add a
\&\fIset alert 'email'\fR statement for each address.
.PP
\fISetting an event filter\fR
.IX Subsection "Setting an event filter"
.PP
If you only want an alert message sent for certain events, then list them in
the \fI{event, ...}\fR block, e.g.:
.PP
.Vb 1
\& set alert foo@bar only on { timeout, nonexist }
.Ve
.PP
You can also set exclude list (negate the list) to send alerts for all events
except those which are listed, by prepending the list with the word \fInot\fR.
For example to receive all alerts except notification about Monit program start
or stop:
.PP
.Vb 1
\& set alert foo@bar but not on { instance }
.Ve
.PP
List of all possible event types (value from the first column can be used in
the event filter:
.PP
.Vb 10
\& Event:     | Failure state:            | Success state:              
\& \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
\& ACTION     | "Action done"             | "Action done"               
\& CHECKSUM   | "Checksum failed"         | "Checksum succeeded"        
\& CONNECTION | "Connection failed"       | "Connection succeeded"      
\& CONTENT    | "Content failed",         | "Content succeeded"
\& DATA       | "Data access error"       | "Data access succeeded"     
\& EXEC       | "Execution failed"        | "Execution succeeded"       
\& FSFLAGS    | "Filesystem flags failed" | "Filesystem flags succeeded"
\& GID        | "GID failed"              | "GID succeeded"             
\& ICMP       | "ICMP failed"             | "ICMP succeeded"            
\& INSTANCE   | "Monit instance changed"  | "Monit instance changed not"
\& INVALID    | "Invalid type"            | "Type succeeded"            
\& NONEXIST   | "Does not exist"          | "Exists"                    
\& PERMISSION | "Permission failed"       | "Permission succeeded"      
\& PID        | "PID failed"              | "PID succeeded"
\& PPID       | "PPID failed"             | "PPID succeeded"
\& RESOURCE   | "Resource limit matched"  | "Resource limit succeeded"  
\& SIZE       | "Size failed"             | "Size succeeded"            
\& STATUS     | "Status failed"           | "Status succeeded"            
\& TIMEOUT    | "Timeout"                 | "Timeout recovery"          
\& TIMESTAMP  | "Timestamp failed"        | "Timestamp succeeded"       
\& UID        | "UID failed"              | "UID succeeded"             
\& UPTIME     | "Uptime failed"           | "Uptime succeeded"
.Ve
.PP
Each alert recipient can have its own filter, for example:
.PP
.Vb 3
\& set alert foo@bar { nonexist, timeout, resource, icmp, connection }
\& set alert security@bar on { checksum, permission, uid, gid }
\& set alert admin@bar
.Ve
.PP
\fISetting an error reminder\fR
.IX Subsection "Setting an error reminder"
.PP
Monit by default sends just \fBone\fR notification if a service failed
and another notification when it recovered. If you want to be notified
that the service is still failed, you can use the reminder option in
the alert statement:
.IP "\s-1SET\s0 \s-1ALERT\s0 mail-address [\s-1WITH\s0] \s-1REMINDER\s0 [\s-1ON\s0] number [\s-1CYCLES\s0]" 4
.IX Item "SET ALERT mail-address [WITH] REMINDER [ON] number [CYCLES]"
.PP
For example if you want to be notified each tenth cycle if a
service remains in a failed state, you can use:
.PP
.Vb 1
\&  alert foo@bar with reminder on 10 cycles
.Ve
.PP
Likewise if you want to be notified on each failed cycle, you can
use:
.PP
.Vb 1
\&  alert foo@bar with reminder on 1 cycle
.Ve
.SS "Disabling alerts for some service"
.IX Subsection "Disabling alerts for some service"
To suppress alerts for some user and service, add the \s-1NOALERT\s0 statement in the
context of the service which show not generate alerts:
.IP "\s-1NOALERT\s0 mail-address" 4
.IX Item "NOALERT mail-address"
.PP
Example (send all alerts to foo@bar except for service p3):
.PP
.Vb 1
\& set alert foo@bar
\&
\& check process p1 with pidfile /var/run/p1.pid
\&
\& check process p2 with pidfile /var/run/p2.pid
\&
\& check process p3 with pidfile /var/run/p3.pid
\&     noalert foo@bar
.Ve
.SS "Message format"
.IX Subsection "Message format"
Monit provides a default message format. You can set custom message
format using \fIset mail-format\fR statement:
.IP "\s-1SET\s0 MAIL-FORMAT {mail\-format}" 4
.IX Item "SET MAIL-FORMAT {mail-format}"
.PP
Example:
.PP
.Vb 8
\& set mail\-format {
\&      from: monit@foo.bar
\&  reply\-to: support@domain.com
\&   subject: $SERVICE $EVENT at $DATE
\&   message: Monit $ACTION $SERVICE at $DATE on $HOST: $DESCRIPTION.
\&            Yours sincerely,
\&            monit
\& }
.Ve
.PP
The \fIfrom:\fR option is the sender email address.
.PP
The \fIreply-to:\fR option can be used to set the reply-to mail header.
.PP
The \fIsubject:\fR option allows to set message subject and must be on
only \fIone\fR line.
.PP
The \fImessage:\fR option sets the mail body. This option should always
be the last in a mail-format statement. The mail body can be as long
as needed, but must \fBnot\fR contain the '}' character.
.PP
You can set only the option which you want to override. For example
to change sender address only:
.PP
.Vb 1
\& set mail\-format { from: bofh@foo.bar }
.Ve
.PP
The subject and body may contain \f(CW$XYZ\fR variables, which are expanded
by Monit:
.IP "\(bu" 4
\&\fI\f(CI$EVENT\fI\fR
.Sp
.Vb 1
\& A string describing the event that occurred.
.Ve
.IP "\(bu" 4
\&\fI\f(CI$SERVICE\fI\fR
.Sp
.Vb 1
\& The service name
.Ve
.IP "\(bu" 4
\&\fI\f(CI$DATE\fI\fR
.Sp
.Vb 1
\& The current time and date (RFC 822 date style).
.Ve
.IP "\(bu" 4
\&\fI\f(CI$HOST\fI\fR
.Sp
.Vb 1
\& The name of the host Monit is running on
.Ve
.IP "\(bu" 4
\&\fI\f(CI$ACTION\fI\fR
.Sp
.Vb 1
\& The name of the action which was done by Monit.
.Ve
.IP "\(bu" 4
\&\fI\f(CI$DESCRIPTION\fI\fR
.Sp
.Vb 1
\& The description of the error condition
.Ve
.SS "Setting a mail server for alert delivery"
.IX Subsection "Setting a mail server for alert delivery"
The mail server Monit should use to send alert messages is
defined with a \fIset mailserver\fR statement:
.PP
.Vb 3
\& SET MAILSERVER <hostname|ip\-address [PORT number] [USERNAME string] [PASSWORD string] [using SSLAUTO|SSLV2|SSLV3|TLSV1|TLSV11|TLSV12] [CERTMD5 checksum]>, ...
\&                [with TIMEOUT X SECONDS]
\&                [using HOSTNAME hostname]
.Ve
.PP
Multiple mailservers can be set using a comma separated list. If
Monit cannot connect to the first server, it will try the next in
the list.
.PP
The port statement allows to override the default \s-1SMTP\s0 port
(465 for \s-1SSL\s0, or 25 for \s-1TLS\s0 and non secure connection).
.PP
Monit supports \s-1AUTH\s0 \s-1PLAIN\s0 and \s-1AUTH\s0 \s-1LOGIN\s0 for \s-1SMTP\s0 authentication.
You can set a username and a password using the \s-1USERNAME\s0 and
\&\s-1PASSWORD\s0 options.
.PP
You can enable \s-1SSL\s0 or \s-1TLS\s0 with optional certificate checksum.
.PP
The default connection timeout is 5 seconds. You can rise this
limit using the \s-1TIMEOUT\s0 option.
.PP
Example (setting two mail servers for failover):
.PP
.Vb 1
\& set mailserver mail1.foo.bar, mail2.foo.bar
.Ve
.PP
By default, Monit uses the local host name in \s-1SMTP\s0 \s-1HELO/EHLO\s0
and in the Message-ID header. You can override it using the
\&\s-1HOSTNAME\s0 option.
.SS "Event queue"
.IX Subsection "Event queue"
If no mail server is available, Monit \fIcan\fR queue events on the
local file-system for retry until mail server recovery.
.PP
If Monit is configured with M/Monit, the event queue provides safe
event store for M/Monit in the case of temporary problems as well.
.PP
The event queue is persistent across Monit restarts and provided
that the back-end filesystem is persistent too, across system
restart as well.
.PP
By default, the queue is disabled and if the alert handler fails,
Monit will simply drop the alert message.
.PP
To enable the event queue, add the following statement:
.PP
.Vb 1
\& SET EVENTQUEUE BASEDIR <path> [SLOTS <number>]
.Ve
.PP
The <path> is the path to the directory where events will be
stored.
.PP
Optionally if you want to limit the queue size, use the slots
option to only store up to \fInumber\fR event messages.
.PP
Example:
.PP
.Vb 1
\&  set eventqueue basedir /var/monit slots 5000
.Ve
.PP
If you are running more then one Monit instance on the same
machine, you \fBmust\fR use separated event queue directories.
.SH "SERVICE METHODS"
.IX Header "SERVICE METHODS"
Each service can have \fIstart\fR, \fIstop\fR and \fIrestart\fR methods
which allow Monit to perform corresponding action with the service.
.PP
Syntax:
.ie n .IP "<\s-1START\s0 | \s-1STOP\s0 | \s-1RESTART\s0> [\s-1PROGRAM\s0] = ""program"" [[\s-1AS\s0] \s-1UID\s0 <number | string>] [[\s-1AS\s0] \s-1GID\s0 <number | string>] [[\s-1WITH\s0] \s-1TIMEOUT\s0 <number> \s-1SECOND\s0(S)]" 4
.el .IP "<\s-1START\s0 | \s-1STOP\s0 | \s-1RESTART\s0> [\s-1PROGRAM\s0] = ``program'' [[\s-1AS\s0] \s-1UID\s0 <number | string>] [[\s-1AS\s0] \s-1GID\s0 <number | string>] [[\s-1WITH\s0] \s-1TIMEOUT\s0 <number> \s-1SECOND\s0(S)]" 4
.IX Item "<START | STOP | RESTART> [PROGRAM] = program [[AS] UID <number | string>] [[AS] GID <number | string>] [[WITH] TIMEOUT <number> SECOND(S)]"
.PP
If the \fIprogram\fR is shell script it must begin with \f(CW\*(C`#!\*(C'\fR and
the remainder of the first line must specify an interpreter for
the program. e.g. \f(CW\*(C`#!/bin/sh\*(C'\fR
.PP
The \fIprogram\fR must be executable (for example mode 0755).
.PP
It's possible to write scripts directly into the \fIprogram\fR this
way:
.PP
.Vb 1
\& stop = "/bin/bash \-c \*(Aqkill \-s SIGTERM \`cat /var/run/myproc.pid\`\*(Aq"
.Ve
.PP
By default the program is executed as the user under which Monit
is running. If Monit is running as root, you may optionally specify
the \fI\s-1UID\s0\fR and \fI\s-1GID\s0\fR the executed program should switch to.
.PP
Example:
.PP
.Vb 3
\& check process mmonit with pidfile /usr/local/mmonit/mmonit/logs/mmonit.pid
\&   start program = "/usr/local/mmonit/bin/mmonit \-d" as uid "mmonit" and gid "mmonit"
\&   stop program = "/usr/local/mmonit/bin/mmonit stop" as uid "mmonit" and gid "mmonit"
.Ve
.PP
In the case of process check, Monit waits up to 30 seconds for the
start/stop action to finish by checking the process table. You can
override the action timeout using the \fI\s-1TIMEOUT\s0\fR option.
.PP
Example:
.PP
.Vb 3
\& check process foobar with pidfile /var/run/foobar.pid
\&   start program = "/etc/init.d/foobar start" with timeout 60 seconds
\&   start program = "/etc/init.d/foobar stop"
.Ve
.SH "SERVICE POLL TIME"
.IX Header "SERVICE POLL TIME"
Services are checked in regular intervals given by the \fIset
daemon n\fR statement. Checks are performed in the same order as
they are written in the \fI.monitrc\fR file, except if dependencies
are setup between services, in which case the services hierarchy
may alternate the order of the checks.
.PP
It is possible to modify the check schedule using the \fIevery\fR
statement.
.PP
There are three variants:
.IP "1. custom interval based on poll cycle length multiple" 4
.IX Item "1. custom interval based on poll cycle length multiple"
.Vb 1
\&      EVERY [number] CYCLES
.Ve
.IP "2. test schedule based on cron-style string" 4
.IX Item "2. test schedule based on cron-style string"
.Vb 1
\&      EVERY [cron]
.Ve
.IP "3. do-not-test schedule based on cron-style string" 4
.IX Item "3. do-not-test schedule based on cron-style string"
.Vb 1
\&      NOT EVERY [cron]
.Ve
.PP
A cron-style string, consist of 5 fields separated with
white-space. All fields are required:
.PP
.Vb 7
\& Name:        | Allowed values:            | Special characters:              
\& \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
\& Minutes      | 0\-59                       | * \- ,
\& Hours        | 0\-23                       | * \- ,
\& Day of month | 1\-31                       | * \- ,
\& Month        | 1\-12 (1=jan, 12=dec)       | * \- ,
\& Day of week  | 0\-6 (0=sunday, 6=saturday) | * \- ,
.Ve
.PP
The special characters:
.PP
.Vb 10
\& Character:   | Description:
\& \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
\& * (asterisk) | The asterisk indicates that the expression will
\&              | match for all values of the field; e.g., using
\&              | an asterisk in the 4th field (month) would
\&              | indicate every month.
\& \- (hyphen)   | Hyphens are used to define ranges. For example,
\&              | 8\-9 in the hour field indicate between 8AM and
\&              | 9AM. Note that range is from time1 until and
\&              | including time2. That is, from 8AM and until
\&              | 10AM unless minutes are set. Another example,
\&              | 1\-5 in the weekday field, specify from monday to
\&              | friday (including friday).
\& , (comma)    | Comma are used to specify a sequence. For example
\&              | 17,18 in the day field indicate the 17th and 18th
\&              | day of the month. A sequence can also include
\&              | ranges. For example, using 1\-5,0 in the weekday
\&              | field indicate monday to friday and sunday.
.Ve
.PP
Example 1: Check once per two cycles
.PP
.Vb 2
\& check process nginx with pidfile /var/run/nginx.pid
\&   every 2 cycles
.Ve
.PP
Example 2: Check every workday 8AM\-7PM
.PP
.Vb 3
\& check program checkOracleDatabase with
\&       path /var/monit/programs/checkoracle.pl
\&   every "* 8\-19 * * 1\-5"
.Ve
.PP
Example 3: Do not run the check in the backup window on 
Sunday 0AM\-3AM
.PP
.Vb 2
\& check process mysqld with pidfile /var/run/mysqld.pid
\&   not every "* 0\-3 * * 0"
.Ve
.PP
Limitations:
.PP
The current test scheduler is poll cycle based. When Monit starts
testing and the service test is constraint with the \fIevery cron\fR
statement, it checks whether the current time match the
cron-string pattern. If it does, the test is done, otherwise it
is skipped. The cron specification thus does not guarantee when
exactly the test will run \- that depends on the default poll time
and the length of the testing cycle. In other words, we cannot
guarantee that Monit will run on a specific time. Therefor we
\&\fBstrongly\fR recommend to use an asterix in the minute field or at
minimum a range, e..g. 0\-15. \fBNever\fR use a specific minute as
Monit may not run on that minute.
.PP
We will address this limitation in a future release and convert
the test scheduler from serial polling into a parallel
non-blocking scheduler where checks are guaranteed to run on time
and with seconds resolution.
.SH "SERVICE GROUPS"
.IX Header "SERVICE GROUPS"
Service entries in the control file, \fImonitrc\fR, can be grouped
together by the \fIgroup\fR statement. The syntax is simply (keyword
in capital):
.PP
.Vb 1
\&  GROUP groupname
.Ve
.PP
With this statement it is possible to group similar service
entries together and manage them as a whole. Monit provides
functions to start, stop, restart, monitor and unmonitor a
group of services, like so:
.PP
To start a group of services from the console:
.PP
.Vb 1
\&  monit \-g <groupname> start
.Ve
.PP
To stop a group of services:
.PP
.Vb 1
\&  monit \-g <groupname> stop
.Ve
.PP
To restart a group of services:
.PP
.Vb 1
\&  monit \-g <groupname> restart
.Ve
.PP
Note:
the \fIstatus\fR and \fIsummary\fR commands don't support the \-g
option and will print the state of all services.
.PP
Service can be added to multiple groups by adding group statement
multiple times:
.PP
.Vb 2
\&  group www
\&  group filesystem
.Ve
.SH "SERVICE MONITORING MODE"
.IX Header "SERVICE MONITORING MODE"
Monit supports three monitoring modes per service: \fIactive\fR,
\&\fIpassive\fR and \fImanual\fR. See also the example section below for
usage of the mode statement.
.PP
In \fIactive\fR mode, Monit will pro-actively monitor a service and
in case of problems Monit will raise alerts and/or restart the
service. Active mode is the default mode.
.PP
In \fIpassive\fR mode, Monit will passively monitor a service and
will raise alerts, but will \fBnot\fR try to fix a problem.
.PP
In \fImanual\fR mode, Monit will enter \fIactive\fR mode \fBonly\fR if a
service was started via Monit:
.PP
.Vb 1
\&  monit start <servicename>
.Ve
.PP
Use \*(L"monit stop <servicename>\*(R" to stop the service and take it out
of Monit control. The manual mode can be used to build simple
cluster with active/passive HA-services.
.PP
A service's monitoring state is persistent across Monit restart.
.PP
If you use Monit in a HA-cluster you should place the state file
in a temporary filesystem so if the machine which runs HA-services
should crash and the stand-by machine take over its services, the
HA-services won't be started after the crashed node will boot again:
.PP
.Vb 1
\&  set statefile /tmp/monit.state
.Ve
.SH "SERVICE TIMEOUT"
.IX Header "SERVICE TIMEOUT"
\&\fBMonit\fR provides a service timeout mechanism for situations
where a service simply refuses to start or respond over a longer
period.
.PP
The timeout mechanism is based on number of service restarts and
number of poll-cycles. For example, if a service had \fIx\fR
restarts within \fIy\fR poll-cycles (where \fIx\fR <= \fIy\fR) then Monit
will perform an action (for example unmonitor the service). If a
timeout occurs, Monit will send an alert message if you have
register interest for this event.
.PP
The syntax for the timeout statement is as follows (keywords are
in capital):
.IP "\s-1IF\s0 <number> \s-1RESTART\s0 <number> \s-1CYCLE\s0(S) \s-1THEN\s0 <action>" 4
.IX Item "IF <number> RESTART <number> CYCLE(S) THEN <action>"
.PP
Here is an example where Monit will unmonitor the service if it
was restarted 2 times within 3 cycles:
.PP
.Vb 1
\& if 2 restarts within 3 cycles then unmonitor
.Ve
.PP
To have Monit check the service again after a monitoring was
disabled, run 'monit monitor <servicename>' from the command
line.
.PP
Example for setting custom exec on timeout:
.PP
.Vb 1
\& if 5 restarts within 5 cycles then exec "/foo/bar"
.Ve
.PP
Example for stopping the service:
.PP
.Vb 1
\& if 7 restarts within 10 cycles then stop
.Ve
.SH "SERVICE DEPENDENCIES"
.IX Header "SERVICE DEPENDENCIES"
If specified in the control file, Monit can do dependency
checking before start, stop, monitoring or unmonitoring of
services. The dependency statement may be used within any service
entries in the Monit control file.
.PP
The syntax for the depend statement is simply:
.IP "\s-1DEPENDS\s0 on service[, service [,...]]" 4
.IX Item "DEPENDS on service[, service [,...]]"
.PP
Where \fBservice\fR is a service entry name, for instance \fBapache\fR
or \fBdatafs\fR.
.PP
You may add more than one service name of any type or use more
than one depend statement in an entry.
.PP
Services specified in a \fIdepend\fR statement will be checked
during stop/start/monitor/unmonitor operations. If a service is
stopped or unmonitored it will stop/unmonitor any services that
depends on itself. Likewise, if a service is started, it will
first stop any services that depends on itself and after it is
started, start all depending services again. If the service is to
be monitored (enable monitoring), all services which this service
depends on will be monitored before enabling monitoring of this
service.
.PP
Here is an example where we set up an apache service entry to
depend on the underlying apache binary. If the binary should
change an alert is sent and apache is not monitored anymore. The
rationale is security and that Monit should not execute a
possibly cracked apache binary.
.PP
.Vb 7
\& (1) check process apache 
\& (2)    with pidfile "/usr/local/apache/logs/httpd.pid"
\& (3)    ...
\& (4)    depends on httpd
\& (5)
\& (6) check file httpd with path /usr/local/apache/bin/httpd
\& (7)    if failed checksum then unmonitor
.Ve
.PP
The first entry is the process entry for apache shown before
(abbreviated for clarity). The fourth line sets up a dependency
between this entry and the service entry named httpd in line 6. A
depend tree works as follows, if an action is conducted in a
lower branch it will propagate upward in the tree and for every
dependent entry execute the same action. In this case, if the
checksum should fail in line 7 then an unmonitor action is
executed and the apache binary is not checked anymore. But since
the apache process entry depends on the httpd entry this entry
will also execute the unmonitor action. In short, if the checksum
test for the httpd binary file should fail, both the check file
httpd entry and the check process apache entry is set in
un-monitoring mode.
.PP
A dependency tree is a general construct and can be used between
all types of service entries and span many levels and propagate
any supported action (except the exec action which will not
propagate upward in a dependency tree for obvious reasons).
.PP
Here is another different example. Consider the following common
server setup:
.PP
.Vb 2
\&  WEB\-SERVER \-> APPLICATION\-SERVER \-> DATABASE \-> FILESYSTEM
\&      (a)               (b)             (c)          (d)
.Ve
.PP
You can set dependencies so that the web-server depends on the
application server to run before the web-server starts and the
application server depends on the database server and the
database depends on the file-system to be mounted before it
starts. See also the example section below for examples using the
depend statement.
.PP
Here we describe how Monit will function with the above
dependencies:
.IP "If no servers are running" 4
.IX Item "If no servers are running"
Monit will start the servers in the following order: \fId\fR, \fIc\fR,
\&\fIb\fR, \fIa\fR
.IP "If all servers are running" 4
.IX Item "If all servers are running"
When you run 'Monit stop all' this is the stop order: \fIa\fR, \fIb\fR,
\&\fIc\fR, \fId\fR. If you run 'Monit stop d' then \fIa\fR, \fIb\fR and \fIc\fR
are also stopped because they depend on \fId\fR and finally \fId\fR is
stopped.
.IP "If \fIa\fR does not run" 4
.IX Item "If a does not run"
When Monit runs it will start \fIa\fR
.IP "If \fIb\fR does not run" 4
.IX Item "If b does not run"
When Monit runs it will first stop \fIa\fR then start \fIb\fR and
finally start \fIa\fR again.
.IP "If \fIc\fR does not run" 4
.IX Item "If c does not run"
When Monit runs it will first stop \fIa\fR and \fIb\fR then start \fIc\fR
and finally start \fIb\fR then \fIa\fR.
.IP "If \fId\fR does not run" 4
.IX Item "If d does not run"
When Monit runs it will first stop \fIa\fR, \fIb\fR and \fIc\fR then start
\&\fId\fR and finally start \fIc\fR, \fIb\fR then \fIa\fR.
.IP "If the control file contains a depend loop." 4
.IX Item "If the control file contains a depend loop."
A depend loop is for example; a\->b and b\->a or a\->b\->c\->a.
.Sp
When Monit starts it will check for such loops and complain and
exit if a loop was found. It will also exit with a complaint if a
depend statement was used that does not point to a service in the
control file.
.SH "SERVICE TESTS"
.IX Header "SERVICE TESTS"
.SS "\s-1GENERIC\s0 \s-1SYNTAX\s0"
.IX Subsection "GENERIC SYNTAX"
Monit provides several tests you can use in a 'check' statement
to test a service.
.PP
You can test either for some expected value or range or take
action if the value changed.
.PP
General syntax for testing specific value or range:
.IP "\s-1IF\s0 <\s-1TEST\s0> \s-1THEN\s0 \s-1ACTION\s0 [\s-1ELSE\s0 \s-1IF\s0 \s-1SUCCEEDED\s0 \s-1THEN\s0 \s-1ACTION\s0]" 4
.IX Item "IF <TEST> THEN ACTION [ELSE IF SUCCEEDED THEN ACTION]"
.PP
The selected failure action is evaluated each time the <\s-1TEST\s0> condition
is true. Success action is optional and executed only when the state
changes from failure to success. If success action is not set, Monit
will send recovery alert by default.
.PP
General syntax for value change test:
.IP "\s-1IF\s0 \s-1CHANGED\s0 <\s-1TEST\s0> \s-1THEN\s0 \s-1ACTION\s0" 4
.IX Item "IF CHANGED <TEST> THEN ACTION"
.PP
The selected action is executed each time the value changed. Monit
will remember the new value and will trigger event if the value changed
again.
.PP
\fI\s-1ACTION\s0\fR
.IX Subsection "ACTION"
.PP
In each test you must select the action to be executed from this
list:
.IP "\(bu" 4
\&\fB\s-1ALERT\s0\fR sends the user an alert event on each state change.
.IP "\(bu" 4
\&\fB\s-1RESTART\s0\fR restarts the service \fBand\fR sends an alert. Restart
is conducted by calling service's registered restart method or
by first calling the stop method followed by start method if restart
is not set.
.IP "\(bu" 4
\&\fB\s-1START\s0\fR starts the service by calling the service's registered
start method \fBand\fR sends an alert.
.IP "\(bu" 4
\&\fB\s-1STOP\s0\fR stops the service by calling the service's registered
stop method \fBand\fR sends an alert. If Monit stops a service it
will not be checked by Monit anymore nor restarted again later.
To reactivate monitoring of the service again you must explicitly
enable monitoring from the web interface or from the console.
.IP "\(bu" 4
\&\fB\s-1EXEC\s0\fR can be used to execute an arbitrary program \fBand\fR send
an alert. If you choose this action you must state the program to
be executed and if the program require arguments you must enclose
the program and its arguments in a quoted string. You may
optionally specify the uid and gid the executed program should
switch to upon start. For instance:
.Sp
.Vb 2
\& exec "/usr/local/tomcat/bin/startup.sh"
\&      as uid nobody and gid nobody
.Ve
.Sp
Remember, if Monit is run by the superuser, then all programs
executed by Monit will be started with superuser privileges
unless the uid and gid extension was used.
.IP "\(bu" 4
\&\fB\s-1UNMONITOR\s0\fR will disable monitoring of the service \fBand\fR send
an alert. The service will not be checked by Monit anymore nor
restarted again later.  To reactivate monitoring of the service
you must explicitly enable monitoring from the web interface or
from the console.
.PP
\fI\s-1FAILURE\s0 \s-1TOLERANCE\s0\fR
.IX Subsection "FAILURE TOLERANCE"
.PP
By default the action is executed on first match. You can ignore soft errors
and require multiple errors before the event is triggered and the service state
changed to failure.
.PP
Syntax:
.IP "... [\s-1FOR\s0] <X> \s-1CYCLES\s0 ..." 4
.IX Item "... [FOR] <X> CYCLES ..."
.PP
or:
.IP "... <X> [\s-1TIMES\s0 \s-1WITHIN\s0] <Y> \s-1CYCLES\s0 ..." 4
.IX Item "... <X> [TIMES WITHIN] <Y> CYCLES ..."
.PP
The condition can be used both for the failure and success action.
.PP
The first simpler format requires <X> consecutive events before switching the
state:
.PP
.Vb 4
\& if failed 
\&    port 80 
\&    for 10 cycles 
\& then alert
.Ve
.PP
The second format is more advanced and allows to tolerate intermitent issues, but
still catch excessive problems, where the service is flapping between error and
success states frequently.
.PP
For example if every second cycle is failure (1\-0\-1\-0\-1\-0\-...), then \*(L"for 2 cycles\*(R"
condition will never match, despite the service has serious problems. The following
statement will catch such state:
.PP
.Vb 4
\& if failed 
\&    port 80
\&    for 3 times within 5 cycles 
\& then alert
.Ve
.PP
Example which sets multiple error levels and actions:
.PP
.Vb 3
\& check filesystem rootfs with path /dev/hda1
\&  if space usage > 80% for 5 times within 15 cycles then alert
\&  if space usage > 90% for 5 cycles then exec \*(Aq/try/to/free/the/space\*(Aq
.Ve
.SS "\s-1EXISTENCE\s0 \s-1TESTING\s0"
.IX Subsection "EXISTENCE TESTING"
Monit's default action when services does not exist (for example
a process is not running, a file doesn't exist, etc.) is to perform
restart action.
.PP
You can override the default action with following statement:
.IP "\s-1IF\s0 [\s-1DOES\s0] \s-1NOT\s0 \s-1EXIST\s0 \s-1THEN\s0 action" 4
.IX Item "IF [DOES] NOT EXIST THEN action"
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check file with path /cifs/mydata
\&   if does not exist then exec "/usr/bin/mount_cifs.sh"
.Ve
.SS "\s-1RESOURCE\s0 \s-1TESTING\s0"
.IX Subsection "RESOURCE TESTING"
Monit can examine how much system resources a service is using.
This test can only be used within a system or process service
entry in the Monit control file.
.PP
Depending on system or process characteristics, services can be
stopped or restarted and alerts can be generated. Thus it is
possible to utilize systems which are idle and to spare system
under high load.
.PP
The full syntax for a resource-statement used for resource
testing is as follows (keywords are in capital and optional
statements in [brackets]),
.IP "\s-1IF\s0 resource operator value \s-1THEN\s0 action" 4
.IX Item "IF resource operator value THEN action"
.PP
\&\fIresource\fR is a choice of \*(L"\s-1CPU\s0\*(R", \*(L"\s-1TOTAL\s0 \s-1CPU\s0\*(R",
\&\*(L"\s-1CPU\s0([user|system|wait])\*(R", \*(L"\s-1MEMORY\s0\*(R", \*(L"\s-1SWAP\s0\*(R", \*(L"\s-1CHILDREN\s0\*(R", \*(L"\s-1TOTAL\s0 \s-1MEMORY\s0\*(R",
\&\*(L"\s-1LOADAVG\s0([1min|5min|15min])\*(R". Some resource tests can be used
inside a check system entry, some in a check process entry and
some in both:
.PP
System only resource tests:
.PP
\&\s-1CPU\s0([user|system|wait]) is the percent of time the system spend
in user or kernel space and I/O.
.PP
\&\s-1SWAP\s0 is the swap usage of the system in either percent (of the
systems total) or as an amount (Byte, kB, \s-1MB\s0, \s-1GB\s0).
.PP
Process only resource tests:
.PP
\&\s-1CPU\s0 is the \s-1CPU\s0 usage of the process itself (percent).
.PP
\&\s-1TOTAL\s0 \s-1CPU\s0 is the total \s-1CPU\s0 usage of the process and its children
in (percent). You will want to use \s-1TOTAL\s0 \s-1CPU\s0 typically for
services like Apache web server where one master process forks the
child processes as workers.
.PP
\&\s-1CHILDREN\s0 is the number of child processes of the process.
.PP
\&\s-1TOTAL\s0 \s-1MEMORY\s0 is the memory usage of the process and its child
processes in either percent or as an amount (Byte, kB, \s-1MB\s0, \s-1GB\s0).
.PP
System and process resource tests:
.PP
\&\s-1MEMORY\s0 is the memory usage of the system or of a process (without
children) in either percent (of the systems total) or as an
amount (Byte, kB, \s-1MB\s0, \s-1GB\s0).
.PP
\&\s-1LOADAVG\s0([1min|5min|15min]) refers to the system's load average.
The load average is the number of processes in the system run
queue, averaged over the specified time period.
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R", \*(L">\*(R", \*(L"!=\*(R", \*(L"==\*(R" in C notation,
\&\*(L"gt\*(R", \*(L"lt\*(R", \*(L"eq\*(R", \*(L"ne\*(R" in shell sh notation and \*(L"greater\*(R",
\&\*(L"less\*(R", \*(L"equal\*(R", \*(L"notequal\*(R" in human readable form (if not
specified, default is \s-1EQUAL\s0).
.PP
\&\fIvalue\fR is either an integer or a real number (except for
\&\s-1CHILDREN\s0). For \s-1CPU\s0, \s-1TOTAL\s0 \s-1CPU\s0, \s-1MEMORY\s0 and \s-1TOTAL\s0 \s-1MEMORY\s0 you need to
specify a \fIunit\fR. This could be \*(L"%\*(R" or if applicable \*(L"B\*(R" (Byte),
\&\*(L"kB\*(R" (1024 Byte), \*(L"\s-1MB\s0\*(R" (1024 KiloByte) or \*(L"\s-1GB\s0\*(R" (1024 MegaByte).
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
To calculate the cycles, a counter is raised whenever the
expression above is true and it is lowered whenever it is false
(but not below 0). All counters are reset in case of a restart.
.PP
The following is an example to check that the \s-1CPU\s0 usage of a
service is not going beyond 50% during five poll cycles. If it
does, Monit will restart the service:
.PP
.Vb 1
\& if cpu is greater than 50% for 5 cycles then restart
.Ve
.SS "\s-1FILE\s0 \s-1CHECKSUM\s0 \s-1TESTING\s0"
.IX Subsection "FILE CHECKSUM TESTING"
The checksum statement may only be used in a file service
entry and allows to check \s-1MD5\s0 or \s-1SHA1\s0 checksum.
.PP
Check specific checksum:
.IP "\s-1IF\s0 \s-1FAILED\s0 [MD5|SHA1] \s-1CHECKSUM\s0 [\s-1EXPECT\s0 checksum] \s-1THEN\s0 action" 4
.IX Item "IF FAILED [MD5|SHA1] CHECKSUM [EXPECT checksum] THEN action"
.PP
Check any file changes:
.IP "\s-1IF\s0 \s-1CHANGED\s0 [MD5|SHA1] \s-1CHECKSUM\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED [MD5|SHA1] CHECKSUM THEN action"
.PP
The choice of \s-1MD5\s0 or \s-1SHA1\s0 is optional. \s-1MD5\s0 features a 256 bit 
and \s-1SHA1\s0 a 320 bit checksum. If this option is omitted Monit 
tries to guess the method from the \s-1EXPECT\s0 string or uses \s-1MD5\s0 as
default.
.PP
\&\fIexpect\fR is optional and if used it specifies a md5 or sha1
string Monit should expect when testing a file's checksum. If
\&\fIexpect\fR is used, Monit will not compute an initial checksum for
the file, but instead use the string you submit. For example:
.PP
.Vb 3
\& if failed 
\&    checksum expect 8f7f419955cefa0b33a2ba316cba3659
\& then alert
.Ve
.PP
You can, for example, use the \s-1GNU\s0 utility \fI\fImd5sum\fI\|(1)\fR or 
\&\fI\fIsha1sum\fI\|(1)\fR to create a checksum string for a file and 
use this string in the expect-statement.
.PP
Reloading a server if its configuration file was changed:
.PP
.Vb 2
\& check file apache_conf with path /etc/apache/httpd.conf
\&     if changed checksum then exec "/usr/bin/apachectl graceful"
.Ve
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.SS "\s-1TIMESTAMP\s0 \s-1TESTING\s0"
.IX Subsection "TIMESTAMP TESTING"
The timestamp statement may only be used in a file, fifo or
directory service entry.
.PP
Specific timestamp syntax:
.IP "\s-1IF\s0 \s-1TIMESTAMP\s0 [[operator] value [unit]] \s-1THEN\s0 action" 4
.IX Item "IF TIMESTAMP [[operator] value [unit]] THEN action"
.PP
Timestamp change syntax:
.IP "\s-1IF\s0 \s-1CHANGED\s0 \s-1TIMESTAMP\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED TIMESTAMP THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R", \*(L">\*(R", \*(L"!=\*(R", \*(L"==\*(R" in C notation,
\&\*(L"\s-1GT\s0\*(R", \*(L"\s-1LT\s0\*(R", \*(L"\s-1EQ\s0\*(R", \*(L"\s-1NE\s0\*(R" in shell sh notation and \*(L"\s-1GREATER\s0\*(R",
\&\*(L"\s-1LESS\s0\*(R", \*(L"\s-1EQUAL\s0\*(R", \*(L"\s-1NOTEQUAL\s0\*(R" in human readable form (if not
specified, default is \s-1EQUAL\s0).
.PP
\&\fIvalue\fR is a time watermark.
.PP
\&\fIunit\fR is either \*(L"\s-1SECOND\s0(S)\*(R", \*(L"\s-1MINUTE\s0(S)\*(R", \*(L"\s-1HOUR\s0(S)\*(R" or \*(L"\s-1DAY\s0(S)\*(R".
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
For example to reload apache if configuration file timestamp changed:
.PP
.Vb 2
\& check file apache_conf with path /etc/apache/httpd.conf
\&   if changed timestamp then exec "/usr/bin/apachectl graceful"
.Ve
.PP
For example testing directory for file addition or removal:
.PP
.Vb 2
\& check directory mydir path /foo/directory
\&  if timestamp < 1 hour then alert
.Ve
.SS "\s-1FILE\s0 \s-1SIZE\s0 \s-1TESTING\s0"
.IX Subsection "FILE SIZE TESTING"
The size statement may only be used in a check file service
entry. If specified in the control file, Monit will compute
a size for a file.
.PP
Testing specific size or range:
.IP "\s-1IF\s0 \s-1SIZE\s0 [[operator] value [unit]] \s-1THEN\s0 action" 4
.IX Item "IF SIZE [[operator] value [unit]] THEN action"
.PP
Testing size change:
.IP "\s-1IF\s0 \s-1CHANGED\s0 \s-1SIZE\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED SIZE THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R", \*(L">\*(R", \*(L"!=\*(R", \*(L"==\*(R" in C notation,
\&\*(L"\s-1GT\s0\*(R", \*(L"\s-1LT\s0\*(R", \*(L"\s-1EQ\s0\*(R", \*(L"\s-1NE\s0\*(R" in shell sh notation and \*(L"\s-1GREATER\s0\*(R",
\&\*(L"\s-1LESS\s0\*(R", \*(L"\s-1EQUAL\s0\*(R", \*(L"\s-1NOTEQUAL\s0\*(R" in human readable form (if not
specified, default is \s-1EQUAL\s0).
.PP
\&\fIvalue\fR is a size watermark.
.PP
\&\fIunit\fR is a choice of \*(L"B\*(R",\*(L"\s-1KB\s0\*(R",\*(L"\s-1MB\s0\*(R",\*(L"\s-1GB\s0\*(R" or long alternatives
\&\*(L"byte\*(R", \*(L"kilobyte\*(R", \*(L"megabyte\*(R", \*(L"gigabyte\*(R". If it is not
specified, \*(L"byte\*(R" unit is assumed by default.
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
For example to send an alert if the file is too large:
.PP
.Vb 2
\& check file mydb with path /data/mydatabase.db
\&       if size > 1 GB then alert
.Ve
.SS "\s-1FILE\s0 \s-1CONTENT\s0 \s-1TESTING\s0"
.IX Subsection "FILE CONTENT TESTING"
The match statement allows to incrementally test the content of a
text file by using regular expressions.
.PP
Syntax:
.IP "\s-1IF\s0 [\s-1NOT\s0] \s-1MATCH\s0 {regex|path} \s-1THEN\s0 action" 4
.IX Item "IF [NOT] MATCH {regex|path} THEN action"
.PP
\&\fIregex\fR is a string containing the extended regular expression.
See also \fIregex\fR\|(7).
.PP
\&\fIpath\fR is an absolute path to a file containing extended
regular expression on every line. See also \fIregex\fR\|(7).
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
You can use the \fI\s-1NOT\s0\fR statement to invert a match.
.PP
On startup the read position is set to the end of the file 
and Monit continues to scan to the end of the file each cycle.
.PP
If the file size should decrease or inode change the read
position is set to the start of the file.
.PP
Only lines ending with a newline character are inspected.
.PP
Only first 511 characters of a line are inspected.
.IP "\s-1IGNORE\s0 [\s-1NOT\s0] \s-1MATCH\s0 {regex|path}" 4
.IX Item "IGNORE [NOT] MATCH {regex|path}"
.PP
Lines matching an \fI\s-1IGNORE\s0\fR are not inspected during later 
evaluations. \fI\s-1IGNORE\s0 \s-1MATCH\s0\fR has always precedence over 
\&\fI\s-1IF\s0 \s-1MATCH\s0\fR.
.PP
All \fI\s-1IGNORE\s0 \s-1MATCH\s0\fR statements are evaluated first, in the 
order of their appearance. Thereafter, all the \fI\s-1IF\s0 \s-1MATCH\s0\fR 
statements are evaluated.
.PP
For example:
.PP
.Vb 3
\&  check file syslog with path /var/log/syslog
\&    ignore match "^monit"
\&    if match "^mrcoffee" then alert
.Ve
.SS "\s-1FILESYSTEM\s0 \s-1FLAGS\s0 \s-1TESTING\s0"
.IX Subsection "FILESYSTEM FLAGS TESTING"
Monit can test the flags of a filesystem for changes. This test
is implicit and Monit will send alert in case of failure by
default.
.PP
This test is useful for detecting changes of the filesystem flags
such as when the filesystem became read-only (on disk error) or
mount flags were changed (such as nosuid).
.PP
The syntax for the fsflags statement is:
.IP "\s-1IF\s0 \s-1CHANGED\s0 \s-1FSFLAGS\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED FSFLAGS THEN action"
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check filesystem rootfs with path /
\&       if changed fsflags then exec "/my/script"
.Ve
.SS "\s-1SPACE\s0 \s-1TESTING\s0"
.IX Subsection "SPACE TESTING"
Monit can test filesystem space usage. This test may only be used
in the context of a filesystem service type.
.PP
Monit checks a total space usage, including reserved blocks.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1SPACE\s0 operator value unit \s-1THEN\s0 action" 4
.IX Item "IF SPACE operator value unit THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R",\*(L">\*(R",\*(L"!=\*(R",\*(L"==\*(R" in c notation, \*(L"gt\*(R",
\&\*(L"lt\*(R", \*(L"eq\*(R", \*(L"ne\*(R" in shell sh notation and \*(L"greater\*(R", \*(L"less\*(R",
\&\*(L"equal\*(R", \*(L"notequal\*(R" in human readable form (if not specified,
default is \s-1EQUAL\s0).
.PP
\&\fIunit\fR is a choice of \*(L"B\*(R",\*(L"\s-1KB\s0\*(R",\*(L"\s-1MB\s0\*(R",\*(L"\s-1GB\s0\*(R", \*(L"%\*(R" or long
alternatives \*(L"byte\*(R", \*(L"kilobyte\*(R", \*(L"megabyte\*(R", \*(L"gigabyte\*(R",
\&\*(L"percent\*(R".
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check filesystem rootfs with path /
\&       if space usage > 90% then alert
.Ve
.SS "\s-1INODE\s0 \s-1TESTING\s0"
.IX Subsection "INODE TESTING"
Monit can test filesystem inode usage. This test may only be used
in the context of a filesystem service type.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1INODE\s0(S) operator value [unit] \s-1THEN\s0 action" 4
.IX Item "IF INODE(S) operator value [unit] THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R",\*(L">\*(R",\*(L"!=\*(R",\*(L"==\*(R" in c notation, \*(L"gt\*(R",
\&\*(L"lt\*(R", \*(L"eq\*(R", \*(L"ne\*(R" in shell sh notation and \*(L"greater\*(R", \*(L"less\*(R",
\&\*(L"equal\*(R", \*(L"notequal\*(R" in human readable form (if not specified,
default is \s-1EQUAL\s0).
.PP
\&\fIunit\fR is optional. If not specified, the value is an absolute
count of inodes. You can use the \*(L"%\*(R" character or the longer
alternative \*(L"percent\*(R" as a unit.
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check filesystem rootfs with path /
\&       if inode usage > 90% then alert
.Ve
.SS "\s-1PERMISSION\s0 \s-1TESTING\s0"
.IX Subsection "PERMISSION TESTING"
Monit can test the permissions of file objects. This test may
only be used in the context of a file, fifo, directory or
filesystem service types.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1FAILED\s0 \s-1PERM\s0(\s-1ISSION\s0) octalnumber \s-1THEN\s0 action" 4
.IX Item "IF FAILED PERM(ISSION) octalnumber THEN action"
.PP
\&\fIoctalnumber\fR defines permissions for a file, a directory or a
filesystem as four octal digits (0\-7). Valid range: 0000 \- 7777 (you
can omit the leading zeros, Monit will add the zeros to the left
thus for example \*(L"640\*(R" is valid value and matches \*(L"0640\*(R").
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check file shadow with path /etc/shadow
\&       if failed permission 0640 then alert
.Ve
.SS "\s-1UID\s0 \s-1TESTING\s0"
.IX Subsection "UID TESTING"
Monit can monitor the owner user id (uid) of a file, fifo, directory
or owner and effective user of a process.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1FAILED\s0 [E]UID user \s-1THEN\s0 action" 4
.IX Item "IF FAILED [E]UID user THEN action"
.PP
\&\fIuser\fR defines a user id either in numeric or in string form.
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check file shadow with path /etc/shadow
\&       if failed uid root then alert
.Ve
.SS "\s-1GID\s0 \s-1TESTING\s0"
.IX Subsection "GID TESTING"
Monit can monitor the owner group id (gid) of a file, fifo, directory
or process.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1FAILED\s0 \s-1GID\s0 group \s-1THEN\s0 action" 4
.IX Item "IF FAILED GID group THEN action"
.PP
\&\fIgroup\fR defines a group id either in numeric or in string form.
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check file shadow with path /etc/shadow
\&       if failed gid shadow then alert
.Ve
.SS "\s-1PID\s0 \s-1TESTING\s0"
.IX Subsection "PID TESTING"
Monit can test the process' \s-1PID\s0. This test is implicit and Monit will
send a alert in the case that the \s-1PID\s0 changed outside of Monit control.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1CHANGED\s0 \s-1PID\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED PID THEN action"
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
This test is useful to detect possible process restarts which has
occurred in the timeframe between two Monit testing cycles.
.PP
For example if someone changes sshd configuration and do sshd
restart outside of Monit's control you will be notified that the
process was replaced by a new instance:
.PP
.Vb 2
\& check process sshd with pidfile /var/run/sshd.pid
\&       if changed pid then alert
.Ve
.SS "\s-1PPID\s0 \s-1TESTING\s0"
.IX Subsection "PPID TESTING"
Monit can test the process' parent \s-1PID\s0 (\s-1PPID\s0) for changes. This
test is implicit and Monit will send alert in the case that the
\&\s-1PPID\s0 changed outside of Monit control.
.PP
The syntax for the ppid statement is:
.IP "\s-1IF\s0 \s-1CHANGED\s0 \s-1PPID\s0 \s-1THEN\s0 action" 4
.IX Item "IF CHANGED PPID THEN action"
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 2
\& check process myproc with pidfile /var/run/myproc.pid
\&       if changed ppid then exec "/my/script"
.Ve
.SS "\s-1PROCESS\s0 \s-1UPTIME\s0 \s-1TESTING\s0"
.IX Subsection "PROCESS UPTIME TESTING"
The uptime statement may only be used in a process service
type context.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1UPTIME\s0 [[operator] value [unit]] \s-1THEN\s0 action" 4
.IX Item "IF UPTIME [[operator] value [unit]] THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R", \*(L">\*(R", \*(L"!=\*(R", \*(L"==\*(R" in C notation,
\&\*(L"\s-1GT\s0\*(R", \*(L"\s-1LT\s0\*(R", \*(L"\s-1EQ\s0\*(R", \*(L"\s-1NE\s0\*(R" in shell sh notation and \*(L"\s-1GREATER\s0\*(R",
\&\*(L"\s-1LESS\s0\*(R", \*(L"\s-1EQUAL\s0\*(R", \*(L"\s-1NOTEQUAL\s0\*(R" in human readable form (if not
specified, default is \s-1EQUAL\s0).
.PP
\&\fIvalue\fR is a uptime watermark.
.PP
\&\fIunit\fR is either \*(L"\s-1SECOND\s0\*(R", \*(L"\s-1MINUTE\s0\*(R", \*(L"\s-1HOUR\s0\*(R" or \*(L"\s-1DAY\s0\*(R" (it is also
possible to use \*(L"\s-1SECONDS\s0\*(R", \*(L"\s-1MINUTES\s0\*(R", \*(L"\s-1HOURS\s0\*(R", or \*(L"\s-1DAYS\s0\*(R").
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example of restarting the process every three days:
.PP
.Vb 4
\& check process myapp with pidfile /var/run/myapp.pid
\&    start program = "/etc/init.d/myapp start"
\&    stop program = "/etc/init.d/myapp stop"
\&    if uptime > 3 days then restart
.Ve
.SS "\s-1PROGRAM\s0 \s-1STATUS\s0 \s-1TESTING\s0"
.IX Subsection "PROGRAM STATUS TESTING"
You can check the exit status of a program or a script. This test
may only be used within a check program service entry in the Monit
control file.
.PP
Syntax:
.IP "\s-1IF\s0 \s-1STATUS\s0 operator value \s-1THEN\s0 action" 4
.IX Item "IF STATUS operator value THEN action"
.PP
\&\fIoperator\fR is a choice of \*(L"<\*(R",\*(L">\*(R",\*(L"!=\*(R",\*(L"==\*(R" in c notation, \*(L"gt\*(R",
\&\*(L"lt\*(R", \*(L"eq\*(R", \*(L"ne\*(R" in shell sh notation and \*(L"greater\*(R", \*(L"less\*(R",
\&\*(L"equal\*(R", \*(L"notequal\*(R" in human readable form (if not specified,
default is \s-1EQUAL\s0).
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
Example:
.PP
.Vb 3
\& check program myscript with path /usr/local/bin/myscript.sh 
\&       with timeout 500 seconds
\&       if status != 0 then alert
.Ve
.PP
Sample script for the above example (/usr/local/bin/myscript.sh):
.PP
.Vb 3
\& #!/bin/bash
\& echo test
\& exit $?
.Ve
.PP
You can also send parameters with the program:
.PP
.Vb 2
\& check program list\-files with path "/bin/ls \-lrt /tmp/"
\&       if status != 0 then alert
.Ve
.PP
Arguments to the program or script is a sequence of whitespace
separated strings. In the above example the strings '\-lrt' and 
\&'/tmp/' are arguments to the program '/bin/ls'. If arguments are
used, it is recommended to use quotes \fB"\fR to enclose the string,
otherwise quotes are not needed.
.PP
Notes: If the program is a script, the interpreter is required
in first line. The program or script must also be executable.
.PP
Monit will execute the program periodically and if the exit
status of the program does not match the expected result, Monit
can perform an action. In the example above, Monit will raise an
alert if the exit value of \fImyscript\fR is different from 0. By
convention, 0 means the program exited normally.
.PP
Program checks are asynchronous. Meaning that Monit will not wait
for the program to exit, but instead, Monit will start the
program in the background and immediately continue checking the
next service entry in \fImonitrc\fR. At the next cycle, Monit will
check if the program has finished and if so, collect the programs
exit status \- if the status indicate a failure, Monit will raise
an alert message containing the program's error (stderr) output,
if any. If the program has not exited after the first cycle,
Monit will wait another cycle and so on. If the program is still
running after 5 minutes, Monit will kill it and generate a
program timeout event. It is possible to override the default
timeout (see the syntax below).
.PP
The asynchronous nature of the program check allows for
non-blocking behavior in the current Monit design, but it comes
with a side-effect: when the program has finished executing and
is waiting for Monit to collect the result, it becomes a
so-called \*(L"zombie\*(R" process. A zombie process does not consume
any system resources (only the \s-1PID\s0 remains in use) and it is
under Monit's control and the zombie process is removed from the
system as soon as Monit collects the exit status. This means that
every \*(L"check program\*(R" will be associated with either a running
process or a temporary zombie. This unwanted zombie side-effect
will be removed in a later release of Monit.
.PP
Multiple status tests can be used, for example:
.PP
.Vb 3
\& check program hwtest with path /usr/local/bin/hwtest.sh
\&       if status = 1 then alert
\&       if status = 3 for 5 cycles then exec "/usr/local/bin/emergency.sh"
.Ve
.SS "\s-1PING\s0 \s-1TESTING\s0"
.IX Subsection "PING TESTING"
Monit can perform \s-1ICMP\s0 Echo (\s-1PING\s0) test in the context of host
service type. Monit must usually run as root user in order to be
able to perform the \s-1PING\s0 test (requires raw socket privileges which
is usually allowed only to super user).
.PP
Syntax:
.PP
.Vb 3
\&  IF FAILED ICMP TYPE ECHO
\&     [COUNT number] [WITH] [TIMEOUT number SECONDS] 
\&     THEN action
.Ve
.PP
The \fB\s-1COUNT\s0\fR parameter specifies how many consecutive echo requests
will be send to the host in one cycle. In the case that no reply
came within \fB\s-1TIMEOUT\s0\fR frame, Monit reports error. When at least
one reply was received, the test will pass. Monit sends by default
\&\fIthree\fR echo requests in one cycle to prevent false alarm (i.e. up
to 66% packet loss is tolerated). You can set the \fB\s-1COUNT\s0\fR option to
a value between 1 and 20. If you require 100% ping success, set the
count to 1 (i.e. just one request will be sent, and if the packet was
lost an error will be reported).
.PP
If a ping test is used in a check host entry, this test is run first
and if the ping test should fail we assume that the connection to the
host is down and Monit does \fInot\fR continue to test any ports.
.PP
Example:
.PP
.Vb 2
\& check host xyz with address xyz.org
\&       if failed icmp type echo count 5 with timeout 15 seconds then alert
.Ve
.SS "\s-1CONNECTION\s0 \s-1TESTING\s0"
.IX Subsection "CONNECTION TESTING"
Monit can perform connection testing via network ports or via
Unix sockets. A connection test may only be used within a
process or host service type context.
.PP
If a service listens on one or more sockets, Monit can connect to
the port (using \s-1TCP\s0 or \s-1UDP\s0) and verify that the service will accept
a connection and that it is possible to write and read from the socket.
If a connection is not accepted or if there is a problem with socket
I/O, Monit will execute a specified action.
.PP
\&\s-1TCP/UDP\s0 port test syntax:
.IP "\s-1IF\s0 \s-1FAILED\s0 [host] <port> [type] [protocol | {send/expect}+] [timeout] [retry] \s-1THEN\s0 action" 4
.IX Item "IF FAILED [host] <port> [type] [protocol | {send/expect}+] [timeout] [retry] THEN action"
.PP
Unix socket test syntax:
.IP "\s-1IF\s0 \s-1FAILED\s0 <unixsocket> [type] [protocol | {send/expect}+] [timeout] [retry] \s-1THEN\s0 action" 4
.IX Item "IF FAILED <unixsocket> [type] [protocol | {send/expect}+] [timeout] [retry] THEN action"
.PP
Examples:
.PP
.Vb 1
\& if failed port 80 then alert
\&
\& if failed port 53 type udp protocol dns then alert
\&
\& if failed unixsocket /var/run/sophie then alert
.Ve
.PP
Options:
.PP
\&\fIhost: \s-1HOST\s0 hostname\fR. Optionally specify the host to connect to.
If the host is not given then localhost is assumed if this test
is used inside a process entry. If this test was used inside a
remote host entry then the entry's remote host is assumed.
.PP
\&\fIport: \s-1PORT\s0 number\fR. The port number to connect to
.PP
\&\fIunixsocket: \s-1UNIXSOCKET\s0 path\fR. Specifies the path to a Unix
socket (local machine only).
.PP
\&\fItype: \s-1TYPE\s0 {TCP|UDP|TCPSSL}\fR. Optionally specify the socket type
Monit should use when trying to connect to the port. The
different socket types are; \s-1TCP\s0, \s-1UDP\s0 or \s-1TCPSSL\s0, where \s-1TCP\s0 is a
regular stream based socket, \s-1UDP\s0 is a datagram socket and \s-1TCPSSL\s0
specifies that Monit should use a \s-1TCP\s0 socket with \s-1SSL\s0 when
connecting to a port. The default socket type is \s-1TCP\s0. If \s-1TCPSSL\s0
is used you may optionally specify the \s-1SSL/TLS\s0 protocol to be
used and the \s-1MD5\s0 checksum of the server's certificate. The \s-1TCPSSL\s0
options are:
.PP
.Vb 1
\& TCPSSL [SSLAUTO|SSLV2|SSLV3|TLSV1|TLSV11|TLSV12] [CERTMD5 md5sum]
.Ve
.PP
\&\fIprotocol: \s-1PROTO\s0(\s-1COL\s0) protocol\fR. Optionally specify the protocol
Monit should speak when a connection is established. At the
moment Monit knows how to speak:
 \fIAPACHE-STATUS\fR
 \fI\s-1DNS\s0\fR
 \fI\s-1DWP\s0\fR
 \fI\s-1FTP\s0\fR
 \fI\s-1GPS\s0\fR
 \fI\s-1HTTP\s0\fR
 \fI\s-1IMAP\s0\fR
 \fI\s-1CLAMAV\s0\fR
 \fI\s-1LDAP2\s0\fR
 \fI\s-1LDAP3\s0\fR
 \fI\s-1LMTP\s0\fR
 \fI\s-1MEMCACHE\s0\fR
 \fI\s-1MYSQL\s0\fR
 \fI\s-1NNTP\s0\fR
 \fI\s-1NTP3\s0\fR
 \fI\s-1PGSQL\s0\fR
 \fI\s-1POP\s0\fR
 \fIPOSTFIX-POLICY\fR
 \fI\s-1RADIUS\s0\fR
 \fI\s-1RDATE\s0\fR
 \fI\s-1RSYNC\s0\fR
 \fI\s-1SIP\s0\fR
 \fI\s-1SMTP\s0\fR
 \fI\s-1SSH\s0\fR
 \fI\s-1TNS\s0\fR
 \fI\s-1WEBSOCKET\s0\fR
.PP
If the target server's protocol is not found in this list, simply
do not specify the protocol and Monit will use a default connection
test.
.PP
\&\fItimeout: [\s-1WITH\s0] \s-1TIMEOUT\s0 number \s-1SECONDS\s0\fR. Optionally specifies the
connect and read timeout for the connection. If Monit cannot
connect to the server within this time it will assume that the
connection failed and execute the specified action. The default
connect timeout is 5 seconds.
.PP
\&\fIretry: \s-1RETRY\s0 number\fR. Optionally specifies the number of consecutive
retries within the same testing cycle in the case that the
connection failed. The default is fail on first error.
.PP
\&\fIaction\fR is a choice of \*(L"\s-1ALERT\s0\*(R", \*(L"\s-1RESTART\s0\*(R", \*(L"\s-1START\s0\*(R", \*(L"\s-1STOP\s0\*(R",
\&\*(L"\s-1EXEC\s0\*(R" or \*(L"\s-1UNMONITOR\s0\*(R".
.PP
\fISpecific protocol test options\fR
.IX Subsection "Specific protocol test options"
.PP
\s-1GENERIC\s0 (\s-1SEND/EXPECT\s0)
.IX Subsection "GENERIC (SEND/EXPECT)"
.PP
If Monit does not support the protocol spoken by the server,
you can write your own protocol-test using \fIsend\fR and \fIexpect\fR
strings. The \fI\s-1SEND\s0\fR statement sends a string to the server port
and the \fI\s-1EXPECT\s0\fR statement compares a string read from the
server with the string given in the expect statement.
.PP
Syntax:
.PP
.Vb 1
\& [{SEND|EXPECT} "string"]+
.Ve
.PP
Monit will send a string as it is, and you \fBmust\fR remember to
include \s-1CR\s0 and \s-1LF\s0 in the string sent to the server if the protocol
expects such characters to terminate a string (most text based
protocols used over Internet do).
.PP
Monit will by default read up to 255 bytes from the server and
use this string when comparing the \s-1EXPECT\s0 string. You can override
the default value by using this statement at the top of the Monit
configuration file:
.PP
.Vb 1
\& SET EXPECTBUFFER <number> ["b"|"kb"|"mb"]
.Ve
.PP
If your system supports \s-1POSIX\s0 regular expressions, you can use
regular expressions in the \s-1EXPECT\s0 string, see \fIregex\fR\|(7) to learn
more about the types of regular expressions you can use in an
expect string.
.PP
For example, to set the expect buffer to read 10 kilobytes:
.PP
.Vb 1
\& set expectbuffer 10 kb
.Ve
.PP
You can use non-printable characters in a \s-1SEND\s0 string if needed.
Use the hex notation, \e0xHEXHEX to send any char in the range
\&\e0x00\-\e0xFF, that is, 0\-255 in decimal. For example, to test a
Quake 3 server:
.PP
.Vb 2
\& send "\e0xFF\e0xFF\e0xFF\e0xFFgetstatus"
\& expect "sv_floodProtect|sv_maxPing"
.Ve
.PP
Simple \s-1SMTP\s0 protocol test example:
.PP
.Vb 7
\& if failed 
\&    port 25 and
\&    expect "^220.*"
\&    send   "HELO localhost.localdomain\er\en"
\&    expect "^250.*"
\&    send   "QUIT\er\en"
\& then alert
.Ve
.PP
\&\s-1SEND/EXPECT\s0 can be used with any socket type, such as \s-1TCP\s0 sockets,
\&\s-1UNIX\s0 sockets and \s-1UDP\s0 sockets.
.PP
\s-1HTTP\s0
.IX Subsection "HTTP"
.PP
Syntax:
.PP
.Vb 6
\& PROTO(COL) HTTP
\&     [REQUEST "string"]
\&     [STATUS operator number]
\&     [CHECKSUM checksum]
\&     [HOSTHEADER "string"]
\&     [CONTENT {= | != } STRING]
.Ve
.PP
\&\fI\s-1REQUEST\s0\fR option can set an \s-1URI\s0 string specifying a document on the
\&\s-1HTTP\s0 server. If the request statement isn't specified, the default \*(L"/\*(R"
page will be requested.
.PP
For example:
.PP
.Vb 5
\& if failed 
\&    port 80
\&    protocol http
\&    request "/data/show?a=b&c=d"
\& then restart
.Ve
.PP
\&\fI\s-1STATUS\s0\fR option can be used to explicitly test the \s-1HTTP\s0 status 
code returned by the \s-1HTTP\s0 server. If not used, the http protocol test
will fail if the status code returned is greater than or equal to 400. 
You can override this behaviour by using the \fIstatus\fR qualifier.
.PP
For example to test that a page does \fBnot\fR exist (404 should be returned
in this case):
.PP
.Vb 6
\&  if failed
\&     port 80
\&     protocol http
\&     request "/non/existent.php"
\&     status = 404
\&  then alert
.Ve
.PP
\&\fI\s-1CHECKSUM\s0\fR You can test the checksum for documents returned by a \s-1HTTP\s0
server. Either \s-1MD5\s0 or \s-1SHA1\s0 hash can be used. Monit will \fBnot\fR test the
checksum for a document if the server does not set the \s-1HTTP\s0
\&\fIContent-Length\fR header. A \s-1HTTP\s0 server should set this header when it
server a static document (i.e. a file). There are no limitation on the
document size, but keep in mind that Monit will use time to download the
document over the network.
.PP
Example:
.PP
.Vb 6
\& if failed 
\&    port 80
\&    protocol http
\&    request "/page.html" 
\&    checksum 8f7f419955cefa0b33a2ba316cba3659
\& then alert
.Ve
.PP
\&\fI\s-1HOSTHEADER\s0\fR option can be used to explicit specify the \s-1HTTP\s0
host header in the request. If not used, Monit will use the
hostname or IP-address of the host as specified in the statement.
Specifying a host header is useful if you want to connect to the
name-based virtual host.
.PP
For example:
.PP
.Vb 6
\&  if failed 
\&     host 192.168.1.100
\&     port 8080
\&     protocol http
\&     hostheader \*(Aqexample.com\*(Aq
\&  then alert
.Ve
.PP
\&\fI\s-1CONTENT\s0\fR option sets the pattern which is expected in the data
returned by the server. If the pattern doesn't match, event is
triggered.
.PP
For example:
.PP
.Vb 5
\&  if failed
\&     port 80
\&     protocol http
\&     content = "foobar [0\-9.]+"
\&  then alert
.Ve
.PP
APACHE-STATUS
.IX Subsection "APACHE-STATUS"
.PP
The \fIAPACHE-STATUS\fR test allows to check server performance by examination
of the status page generated by Apache's mod_status, which is expected to be at
its default address of http://www.example.com/server\-status.
.PP
Syntax:
.PP
.Vb 1
\& PROTOCOL APACHE\-STATUS <limit operator number>+
.Ve
.PP
\&\fIlimit\fR is acronym for child status:
 o logging (loglimit)
 o closing connections (closelimit)
 o performing \s-1DNS\s0 lookups (dnslimit)
 o in keepalive with a client (keepalivelimit)
 o replying to a client (replylimit)
 o receiving a request (requestlimit)
 o initialising (startlimit)
 o waiting for incoming connections (waitlimit)
 o gracefully closing down (gracefullimit)
 o performing cleanup procedures (cleanuplimit)
.PP
\&\fIoperator\fR is one of \*(L"<\*(R", \*(L"=\*(R", \*(L">\*(R".
.PP
\&\fInumber\fR is percentual numeric limit.
.PP
Each of these limits can be compared against a value relative
to the total number of active Apache child processes.
.PP
You can combine all of these tests into one expression or you can
choose to test a certain limit only. If you combine the limits you
must connect them together using the \s-1OR\s0 keyword.
.PP
Example:
.PP
.Vb 5
\& if failed port 80 protocol apache\-status 
\&        loglimit > 10% or
\&        dnslimit > 50% or
\&        waitlimit < 20%
\& then alert
.Ve
.PP
\s-1SIP\s0
.IX Subsection "SIP"
.PP
The \s-1SIP\s0 protocol is used by communication platform servers such
as Asterisk and FreeSWITCH.
.PP
Syntax:
.PP
.Vb 1
\& PROTOCOL SIP [TARGET valid@uri] [MAXFORWARD n]
.Ve
.PP
\&\fI\s-1TARGET\s0\fR you may specify an alternative recipient for the message,
by adding a valid sip uri after this keyword.
.PP
\&\fI\s-1MAXFORWARD\s0\fR Limit the number of proxies or gateways that can forward the
request to the next server. It's value is an integer in the range
0\-255, set by default to 70. If max-forward = 0, the next server
may respond 200 \s-1OK\s0 (test succeeded) or send a 483 Too Many Hops
(test failed)
.PP
For example:
.PP
.Vb 5
\& check host openser_all with address 127.0.0.1
\&   if failed 
\&      port 5060 type udp protocol sip
\&      with target "localhost:5060" and maxforward 6
\&   then alert
.Ve
.PP
\s-1RADIUS\s0
.IX Subsection "RADIUS"
.PP
Syntax:
.PP
.Vb 1
\& PROTOCOL RADIUS [SECRET string]
.Ve
.PP
\&\fI\s-1SECRET\s0\fR you may specify an alternative secret, default is \*(L"testing123\*(R".
.PP
For example:
.PP
.Vb 7
\& check process radiusd with pidfile /var/run/radiusd.pid
\&       start program = "/etc/init.d/freeradius start"
\&       stop program = "/etc/init.d/freeradius stop"
\&       if failed 
\&          host 127.0.0.1 port 1812 type udp protocol radius
\&          secret testing123
\&       then alert
.Ve
.PP
\s-1WEBSOCKET\s0
.IX Subsection "WEBSOCKET"
.PP
Syntax:
.PP
.Vb 5
\& PROTOCOL WEBSOCKET
\&         [REQUEST string]
\&         [HOST string]
\&         [ORIGIN string]
\&         [VERSION number]
.Ve
.PP
\&\fI\s-1HOST\s0\fR you may specify an alternative Host header
.PP
\&\fI\s-1REQUEST\s0\fR you may specify an alternative request, default is \*(L"/\*(R"
.PP
\&\fI\s-1ORIGIN\s0\fR you may specify an alternative origin, default is \*(L"http://www.mmonit.com\*(R"
.PP
\&\fI\s-1VERSION\s0\fR you may specify an alternative version, default is \*(L"0\*(R"
.PP
For example:
.PP
.Vb 8
\& check host websocket.org with address "echo.websocket.org"
\&       if failed
\&          port 80 protocol websocket
\&          host "echo.websocket.org"
\&          request "/"
\&          origin \*(Aqhttp://websocket.com\*(Aq
\&          version 13
\&       then alert
.Ve
.SH "CONFIGURATION EXAMPLES"
.IX Header "CONFIGURATION EXAMPLES"
The simplest form is just the check statement. In this example we
check to see if the server is running and log a message if not:
.PP
.Vb 1
\& check process nginx with pidfile /var/run/nginx.pid
.Ve
.PP
Checking process without pidfile (based on pattern):
.PP
.Vb 1
\& check process pager matching "/sbin/dynamic_pager \-F /private/var/vm/swapfile"
.Ve
.PP
To have Monit start the server if it's not running, add a start
statement:
.PP
.Vb 3
\& check process nginx with pidfile /var/run/nginx.pid
\&       start program = "/etc/init.d/nginx start"
\&       stop program  = "/etc/init.d/nginx stop"
.Ve
.PP
Here's a more advanced example for monitoring an apache
web-server listening on the default port number for \s-1HTTP\s0 and
\&\s-1HTTPS\s0. In this example Monit will restart apache if it's not
accepting connections at the port numbers. The method Monit use
for a process restart is to first execute the stop-program, wait
up to 30s for the process to stop and then execute the start-program
and wait up to 30s for it to start. The length of start or stop
timeout can be overridden using the 'timeout' option. If Monit was
unable to stop or start the service a failed alert message will
be sent if you have requested alert messages to be sent.
.PP
.Vb 5
\& check process apache with pidfile /var/run/httpd.pid
\&       start program = "/etc/init.d/httpd start" with timeout 60 seconds
\&       stop program  = "/etc/init.d/httpd stop"
\&       if failed port 80 then restart
\&       if failed port 443 with timeout 15 seconds then restart
.Ve
.PP
This example demonstrate how you can run a program as a specified
user (uid) and with a specified group (gid). Many daemon programs
will do the uid and gid switch by them self, but for those
programs that does not (e.g. Java programs), monit's ability to
start a program as a certain user can be very useful. In this
example we start the Tomcat Java Servlet Engine as the standard
\&\fInobody\fR user and group. Please note that Monit will only switch
uid and gid for a program if the super-user is running monit,
otherwise Monit will simply ignore the request to change uid and
gid.
.PP
.Vb 7
\& check process tomcat with pidfile /var/run/tomcat.pid
\&       start program = "/etc/init.d/tomcat start" 
\&             as uid nobody and gid nobody
\&       stop program  = "/etc/init.d/tomcat stop"
\&             # You can also use id numbers instead and write:
\&             as uid 99 and with gid 99
\&       if failed port 8080 then alert
.Ve
.PP
In this example we use udp for connection testing to check if the
name-server is running and also use timeout:
.PP
.Vb 5
\& check process named with pidfile /var/run/named.pid
\&       start program = "/etc/init.d/named start"
\&       stop program  = "/etc/init.d/named stop"
\&       if failed port 53 use type udp protocol dns then restart
\&       if 3 restarts within 5 cycles then timeout
.Ve
.PP
The following example illustrates how to check if the service
\&'sophie' is answering connections on its Unix domain socket:
.PP
.Vb 4
\& check process sophie with pidfile /var/run/sophie.pid
\&       start program = "/etc/init.d/sophie start"
\&       stop  program = "/etc/init.d/sophie stop"
\&       if failed unix /var/run/sophie then restart
.Ve
.PP
In this example we check an apache web-server running on
localhost that answers for several IP-based virtual hosts or
vhosts, hence the host statement before port:
.PP
.Vb 7
\& check process apache with pidfile /var/run/httpd.pid
\&       start "/etc/init.d/httpd start"
\&       stop  "/etc/init.d/httpd stop"
\&       if failed host www.sol.no port 80 then alert
\&       if failed host shop.sol.no port 443 then alert
\&       if failed host chat.sol.no port 80 then alert
\&       if failed host www.tildeslash.com port 80 then alert
.Ve
.PP
To make sure that Monit is communicating with a http server a
protocol test can be added:
.PP
.Vb 6
\& check process apache with pidfile /var/run/httpd.pid
\&       start "/etc/init.d/httpd start"
\&       stop  "/etc/init.d/httpd stop"
\&       if failed 
\&          host www.sol.no port 80 protocol http
\&       then alert
.Ve
.PP
This example shows a different way to check a webserver using
the send/expect mechanism:
.PP
.Vb 8
\& check process apache with pidfile /var/run/httpd.pid
\&       start "/etc/init.d/httpd start"
\&       stop  "/etc/init.d/httpd stop"
\&       if failed 
\&          host www.sol.no port 80 and
\&          send "GET / HTTP/1.1\er\enHost: www.sol.no\er\en\er\en"
\&          expect "HTTP/[0\-9\e.]{3} 200.*"
\&       then alert
.Ve
.PP
Here we use an icmp ping test to check if a remote host is up and
if not send an alert:
.PP
.Vb 4
\& check host www.tildeslash.com with address www.tildeslash.com
\&       if failed 
\&          icmp type echo count 5 with timeout 15 seconds
\&       then alert
.Ve
.PP
In the following example we ask Monit to compute and verify the
checksum for the underlying apache binary used by the start and
stop programs. If the the checksum test should fail, monitoring
will be disabled to prevent possibly starting a compromised
binary:
.PP
.Vb 5
\& check process apache with pidfile /var/run/httpd.pid
\&       start program = "/etc/init.d/httpd start"
\&       stop program  = "/etc/init.d/httpd stop"
\&       if failed host www.tildeslash.com port 80 then restart
\&       depends on apache_bin
\&
\& check file apache_bin with path /usr/local/apache/bin/httpd
\&       if failed checksum then unmonitor
.Ve
.PP
In this example we ask Monit to test the checksum for a document
on a remote server. If the checksum was changed we send an alert:
.PP
.Vb 6
\& check host tildeslash with address www.tildeslash.com
\&       if failed 
\&          port 80 protocol http and 
\&          request "/monit/dist/monit\-5.7.tar.gz"
\&          with checksum f9d26b8393736b5dfad837bb13780786
\&       then alert
.Ve
.PP
Here are a couple of tests for some popular communication
servers, using the \s-1SIP\s0 protocol. First we test a FreeSWITCH
server and then an Asterisk server
.PP
.Vb 12
\& check process freeswitch 
\&    with pidfile /usr/local/freeswitch/log/freeswitch.pid
\&  start program = "/usr/local/freeswitch/bin/freeswitch \-nc \-hp"
\&  stop program = "/usr/local/freeswitch/bin/freeswitch \-stop"
\&  if total memory > 1000.0 MB for 5 cycles then alert
\&  if total memory > 1500.0 MB for 5 cycles then alert
\&  if total memory > 2000.0 MB for 5 cycles then restart
\&  if cpu > 60% for 5 cycles then alert
\&  if failed 
\&     port 5060 type udp protocol SIP
\&     target me@foo.bar and maxforward 10 
\&  then restart
\&
\& check process asterisk 
\&   with pidfile /var/run/asterisk/asterisk.pid
\&   start program = "/usr/sbin/asterisk"
\&   stop program = "/usr/sbin/asterisk \-r \-x \*(Aqshutdown now\*(Aq"
\&   if total memory > 1000.0 MB for 5 cycles then alert
\&   if total memory > 1500.0 MB for 5 cycles then alert
\&   if total memory > 2000.0 MB for 5 cycles then restart
\&   if cpu > 60% for 5 cycles then alert
\&   if failed 
\&      port 5060 type udp protocol SIP
\&      and target me@foo.bar maxforward 10
\&   then restart
.Ve
.PP
Some servers are slow starters, like for example Java based
Application Servers. So if we want to keep the poll-cycle low
(i.e. < 60 seconds) but allow some services to take its time to
start, the \fBevery\fR statement is handy:
.PP
.Vb 4
\& check process dynamo with pidfile /etc/dynamo.pid every 2 cycles
\&       start program = "/etc/init.d/dynamo start"
\&       stop program  = "/etc/init.d/dynamo stop"
\&       if failed port 8840 then alert
.Ve
.PP
Here is an example where we group together two database entries
so you can manage them together, e.g.; 'Monit \-g database start
all'. The mode statement is also illustrated in the first entry
and have the effect that Monit will not try to (re)start this
service if it is not running:
.PP
.Vb 5
\& check process sybase with pidfile /var/run/sybase.pid
\&       start = "/etc/init.d/sybase start"
\&       stop  = "/etc/init.d/sybase stop"
\&       mode passive
\&       group database
\&
\& check process oracle with pidfile /var/run/oracle.pid
\&       start program = "/etc/init.d/oracle start"
\&       stop program  = "/etc/init.d/oracle stop"
\&       mode active # Not necessary really, since it\*(Aqs the default
\&       if failed 
\&          port 9001 protocol tns
\&       then restart
\&       group database
.Ve
.PP
Here is an example to show the usage of the resource checks. It
will send an alert when the \s-1CPU\s0 usage of the http daemon and its
child processes raises beyond 60% for over two cycles. Apache is
restarted if the \s-1CPU\s0 usage is over 80% for five cycles or the
memory usage over 100Mb for five cycles or if the machines load
average is more than 10 for 8 cycles:
.PP
.Vb 8
\& check process apache with pidfile /var/run/httpd.pid
\&       start program = "/etc/init.d/httpd start"
\&       stop program  = "/etc/init.d/httpd stop"
\&       if cpu > 40% for 2 cycles then alert
\&       if total cpu > 60% for 2 cycles then alert
\&       if total cpu > 80% for 5 cycles then restart
\&       if mem > 100 MB for 5 cycles then stop
\&       if loadavg(5min) greater than 10.0 for 8 cycles then stop
.Ve
.PP
This examples demonstrate the timestamp statement with exec and
how you may restart apache if its configuration file was
changed.
.PP
.Vb 3
\& check file httpd.conf with path /etc/httpd/httpd.conf
\&       if changed timestamp
\&          then exec "/etc/init.d/httpd graceful"
.Ve
.PP
In this example we demonstrate usage of the extended alert
statement and a file check dependency:
.PP
.Vb 10
\& check process apache with pidfile /var/run/httpd.pid
\&      start = "/etc/init.d/httpd start"
\&      stop  = "/etc/init.d/httpd stop"
\&      alert admin@bar on {nonexist, timeout} 
\&        with mail\-format { 
\&              from:     bofh@$HOST
\&              subject:  apache $EVENT \- $ACTION
\&              message:  This event occurred on $HOST at $DATE. 
\&              Your faithful employee,
\&              monit
\&      }
\&      if failed host www.tildeslash.com  port 80 then restart
\&      if 3 restarts within 5 cycles then timeout
\&      depend httpd_bin
\&      group apache
\&
\& check file httpd_bin with path /usr/local/apache/bin/httpd
\&       alert security@bar on {checksum, timestamp, 
\&                  permission, uid, gid}
\&             with mail\-format {subject: Alaaarrm! on $HOST}
\&       if failed checksum 
\&          and expect 8f7f419955cefa0b33a2ba316cba3659
\&              then unmonitor
\&       if failed permission 755 then unmonitor
\&       if failed uid root then unmonitor
\&       if failed gid root then unmonitor
\&       if changed timestamp then alert
\&       group apache
.Ve
.PP
In this example, we demonstrate usage of the depend statement. In
this case, we want to start oracle and apache. However, we've set
up apache to use oracle as a back end, and if oracle is
restarted, apache must be restarted as well.
.PP
.Vb 4
\& check process apache with pidfile /var/run/httpd.pid
\&       start = "/etc/init.d/httpd start"
\&       stop  = "/etc/init.d/httpd stop"
\&       depends on oracle
\&
\& check process oracle with pidfile /var/run/oracle.pid
\&       start = "/etc/init.d/oracle start"
\&       stop  = "/etc/init.d/oracle stop"
\&       if failed port 9001 for 5 cycles then restart
.Ve
.PP
Next, we have 2 services, oracle-import and oracle-export that
need to be restarted if oracle is restarted, but are independent
of each other.
.PP
.Vb 4
\& check process oracle with pidfile /var/run/oracle.pid
\&       start = "/etc/init.d/oracle start"
\&       stop  = "/etc/init.d/oracle stop"
\&       if failed port 9001 for 3 cycles then restart
\&
\& check process oracle\-import 
\&      with pidfile /var/run/oracle\-import.pid
\&       start = "/etc/init.d/oracle\-import start"
\&       stop  = "/etc/init.d/oracle\-import stop"
\&       depends on oracle
\&
\& check process oracle\-export 
\&      with pidfile /var/run/oracle\-export.pid
\&       start = "/etc/init.d/oracle\-export start"
\&       stop  = "/etc/init.d/oracle\-export stop"
\&       depends on oracle
.Ve
.SH "FILES"
.IX Header "FILES"
\&\fI~/.monitrc\fR  
   Default run control file
.PP
\&\fI/etc/monitrc\fR
   If the control file is not found in the default 
   location and /etc contains a \fImonitrc\fR file, this
   file will be used instead.
.PP
\&\fI./monitrc\fR  
   If the control file is not found in either of the
   previous two locations, and the current working 
   directory contains a \fImonitrc\fR file, this file is 
   used instead.
.PP
\&\fI~/.monit.pid\fR
   Lock file to help prevent concurrent runs (non-root
   mode).
.PP
\&\fI/run/monit.pid\fR
   Lock file to help prevent concurrent runs (root mode,
   Linux systems, if /run directory is available).
.PP
\&\fI/var/run/monit.pid\fR
   Lock file to help prevent concurrent runs (root mode,
   Linux systems).
.PP
\&\fI/etc/monit.pid\fR
   Lock file to help prevent concurrent runs (root mode,
   systems without /var/run).
.PP
\&\fI~/.monit.state\fR  
   Monit saves its state to this file and utilizes
   information found in this file to recover from 
   a crash. This is a binary file and its content is 
   only of interest to monit. You may set the location
   of this file in the Monit control file or by using 
   the \-s switch when Monit is started.
.PP
\&\fI~/.monit.id\fR  
    Monit save its unique id to this file.
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
No environment variables are used by Monit. However, when Monit
execute a script or a program Monit will set several environment
variables which can be utilized by the executable. The following
and \fIonly\fR the following environment variables are available:
.IP "\s-1MONIT_EVENT\s0" 4
.IX Item "MONIT_EVENT"
The event that occurred on the service
.IP "\s-1MONIT_DESCRIPTION\s0" 4
.IX Item "MONIT_DESCRIPTION"
A description of the error condition
.IP "\s-1MONIT_SERVICE\s0" 4
.IX Item "MONIT_SERVICE"
The name of the service (from monitrc) on which the event
occurred.
.IP "\s-1MONIT_DATE\s0" 4
.IX Item "MONIT_DATE"
The time and date (\s-1RFC\s0 822 style) the event occurred
.IP "\s-1MONIT_HOST\s0" 4
.IX Item "MONIT_HOST"
The host the event occurred on
.PP
The following environment variables are only available for
process service entries:
.IP "\s-1MONIT_PROCESS_PID\s0" 4
.IX Item "MONIT_PROCESS_PID"
The process pid. This may be 0 if the process was (re)started,
.IP "\s-1MONIT_PROCESS_MEMORY\s0" 4
.IX Item "MONIT_PROCESS_MEMORY"
Process memory. This may be 0 if the process was (re)started,
.IP "\s-1MONIT_PROCESS_CHILDREN\s0" 4
.IX Item "MONIT_PROCESS_CHILDREN"
Process children. This may be 0 if the process was (re)started,
.IP "\s-1MONIT_PROCESS_CPU_PERCENT\s0" 4
.IX Item "MONIT_PROCESS_CPU_PERCENT"
Process cpu%. This may be 0 if the process was (re)started,
.SH "SIGNALS"
.IX Header "SIGNALS"
If a Monit daemon is running, \s-1SIGUSR1\s0 wakes it up from its sleep
phase and forces a poll of all services. \s-1SIGTERM\s0 and \s-1SIGINT\s0 will
gracefully terminate a Monit daemon. The \s-1SIGTERM\s0 signal is sent
to a Monit daemon if Monit is started with the \fIquit\fR action
argument.
.PP
Sending a \s-1SIGHUP\s0 signal to a running Monit daemon will force
the daemon to reinitialize itself, specifically it will reread
configuration, close and reopen log files.
.PP
Running Monit in foreground while a background Monit daemon is
running will wake up the daemon.
.SH "NOTES"
.IX Header "NOTES"
This is a very silent program. Use the \-v switch if you want to
see what Monit is doing, and tail \-f the logfile. Optionally for
testing purposes; you can start Monit with the \-Iv switch. Monit
will then print debug information to the console, to stop monit
in this mode, simply press CTRL^C (i.e. \s-1SIGINT\s0) in the same
console.
.PP
The syntax (and parser) of the control file was inspired by Eric
S. Raymond et al. excellent fetchmail program. Some portions of
this man page also receive inspiration from the same authors.
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2001\-2014 by Tildeslash Ltd. All Rights Reserved.
This product is distributed in the hope that it will be useful,
but \s-1WITHOUT\s0 any warranty; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS\s0 for a particular purpose.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\s-1GNU\s0 text utilities; \fImd5sum\fR\|(1); \fIsha1sum\fR\|(1); \fIopenssl\fR\|(1); \fIglob\fR\|(7);
\&\fIregex\fR\|(7); \fIhttp://www.mmonit.com/\fR
